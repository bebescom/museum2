<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>...</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="icon" href="../common/favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="css/left.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/relicManagement.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/planDetail.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/newPlan.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/relicsCheck.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/relicsOutStorage.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/relicsStorage.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../equipManagement/css/equip_content.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../relicManagement/css/relic.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/Environmental_levels.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/environment_relic.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/environment_map.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/environment_equipment.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/environment.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../common/css/icon.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../environmentalMonitoring/css/environmental_monitoring.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="css/capsule_content.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="css/Integrated_management.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../js/iview/iview.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="../common/css/header.css?v=2.2.05_P001" />
  <link rel="stylesheet" href="css/index.css?v=2.2.05_P001" />
</head>
<body id="app" v-cloak @click="hideOverlay">
	
	<div id="header" v-cloak>

    <a class="logo" href="">
        <div v-text="web_config.app_name"></div>
    </a>

    <div class="right_top_box">


        <header-down v-ref:down></header-down>

        <div class="warning_logo">
            <Badge :count="all_num" overflow-count="99">
                    <img src="../common/images/warning_logo.png" width="24" height="24" alt="" @click="warningList" />
            </Badge>
        </div>

        <!--<div class="feedback">-->
            <!--<a href="http://wpa.qq.com/msgrd?v=3&uin=3356346419&site=qq&menu=yes" target="_blank"></a>-->
        <!--</div>-->

        <!--<div class="user_logo">-->
            <!--<img src="../common/images/man.png">-->

        <!--</div>-->

        <div class="user_drop">
            <Dropdown placement="bottom-end">
                <div class="user_name" v-text="web_config.user.real_name"></div>
                <Dropdown-menu slot="list">

                    <Dropdown placement="left-start" class="hide">
                        <Dropdown-item class="view">
                            切换视图
                        </Dropdown-item>
                        <Dropdown-menu slot="list">
                            <Dropdown-item>地图视图</Dropdown-item>
                            <Dropdown-item>数据视图</Dropdown-item>
                            <Dropdown-item>工作视图</Dropdown-item>
                        </Dropdown-menu>
                    </Dropdown>
                    <Dropdown-item class="user_set hide">账户设置</Dropdown-item>
                    <Dropdown-item class="system_set hide">系统设置</Dropdown-item>
                    <Dropdown-item class="help hide">帮助中心</Dropdown-item>
                    <Dropdown-item class="paramSetting" @click="paramSetting">平台参数设置</Dropdown-item>
                    <Dropdown-item class="user_set permissionHidden" @click="userManagement(user)"
                                   v-permission="{name:'用户管理'}">用户管理
                    </Dropdown-item>
                    <Dropdown placement="left-start">
                        <Dropdown-item class="view">
                            切换语言
                        </Dropdown-item>
                        <Dropdown-menu slot="list">
                            <Dropdown-item @click="change_language('chinese')">汉语</Dropdown-item>
                            <Dropdown-item @click="change_language('tibetan')">藏语</Dropdown-item>
                            <Dropdown-item @click="change_language('english')">英语</Dropdown-item>
                        </Dropdown-menu>
                    </Dropdown>
                    <Dropdown-item class="logout" @click.stop="exit">退出登录</Dropdown-item>

                </Dropdown-menu>
            </Dropdown>
        </div>
    </div>
</div>

<template id="header_down">
    <div class="equip_down" >

        <Dropdown trigger="custom" :visible="show_list_key">
            <Badge :count="downLoadingLen">
                <img src="../common/images/loading_img.png" alt="下载loading" @click.stop="show_list">
            </Badge>
            <!--<i class="loadingNumber" v-text="downLoadingLen"></i>-->
            <Dropdown-menu slot="list" style="width: 350px;">
                <li class="loading_div" v-for="(index,item) in downLoadList">
                    <div class="singleDown" :classno="item.noClass">
                        <i :class="item.down_status"></i>
                        <Poptip trigger="hover" :content="item.file_name">
                            <span v-text="item.file_name"></span>
                        </Poptip>
                        <Icon v-show="item.url" type="ios-download-outline" @click.stop="down_file(item.url)"
                              class="download_file" data-title="下载文件" size="24"></Icon>
                        <i class="reloading" @click.stop="re_down(item.msg_id)"
                           v-show="item.down_status === 'singleDown_reloading'"></i>
                        <i class="singleDown_clear" @click.stop="del_down(item.msg_id)"></i>
                    </div>
                </li>

            </Dropdown-menu>
        </Dropdown>

        <Progress :percent="45" :stroke-width="5" status="active" v-show="downLoadingLen" hide-info></Progress>

    </div>

</template>
<script type="text/javascript" src="../js/mod.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/jquery-1.10.2.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/ajaxfileupload.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../common/upload.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/components/environment_curve.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/components/environment_data.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/components/environment_equipment.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/components/environment_map.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/components/environment_relic.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/laydate/laydate.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/echarts.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/socket.io.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/underscore-min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../common/socket.io.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/vue.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/iview/iview.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/tooltip.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/store2.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../common/permission.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../js/vue-router.min.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../common/header.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="Integrated_management.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="capsule_content.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/environmental_monitoring.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/environment.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../environmentalMonitoring/Environmental_levels.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/relic.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/relicsStorage.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/relicsOutStorage.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/relicsCheck.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/newPlan.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="../relicManagement/planDetail.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="left.js?v=2.2.05_P001" ></script>
<script type="text/javascript" src="capsule.js?v=2.2.05_P001" ></script>
<script type="text/javascript">
    Vue.component('header-down', {
        template: '#header_down',
        data: function () {
            return {
                show_loading_key: true,//是否显示下载
                show_list_key: false,//是否显示下拉列表
                downLoadList: {},//设备下载传输数据
            }
        },
        computed: {
            downLoadListLength: function () {
                return _.size(this.downLoadList);
            },
            downLoadingLen: function () {
                var _len = 0;
                for (var i in this.downLoadList) {
                    if (this.downLoadList[i].down_status === 'singleDown_status_change') {
                        ++_len;
                    }
                }
                return _len;
            }
        },
        ready: function () {
            var _this = this;
            _this.downLoadList = my_store('downloadEquipData') || {};
            if (_this.downLoadListLength) {
                _this.show_loading_key = true;
            }
            //下载完成后的通知
            window.socket.on("downEquipDataEnd", function (json) {
                console.log(json);
                setTimeout(function () {
                    if (_this.downLoadList[json.msg_id]) {
                        window.socket.emit("downEquipDataAck", json);//确认收到消息
                        _this.end_down(json);//下载完成
                    }
                }, 0);
            });

            window.new_down = _this.new_down;//新建下载队列

        },
        methods: {
            show_list: function () {
                // console.log(this.downLoadingLen)
                // if(!this.downLoadingLen){//当下载数据为0时，不执行下载
                //     return
                // }
                this.show_list_key = !this.show_list_key;
            },
            re_down: function (msg_id) {//重新下载
                var _this = this;
                if (!msg_id || !_this.downLoadList[msg_id]) {
                    return;
                }
                setTimeout(function () {
                    _this.new_down(_this.downLoadList[msg_id]);
                }, 0);
            },
            del_down: function (item_id) {//删除某个下载任务
                console.log('del_down', item_id);
                var _this = this;
                var _list = my_store('downloadEquipData') || {};
                delete _list[item_id];
                _this.downLoadList = _list;
                my_store('downloadEquipData', _this.downLoadList);

                if (_this.downLoadListLength === 0) {
                    _this.show_loading_key = false;
                    _this.show_list_key = false;
                }
            },
            down_file: function (url) {//下载文件
                if (url) {
                    window.location.href = ('/2.2.05_P001/base_api' + url.slice(1));
                }
            },
            new_down: function (msg) {//新建下载任务
                var _this = this;
                msg.msg_id = msg.msg_id || 'down_' + new Date().getTime() + '_' + Math.random();
                msg.down_status = 'singleDown_status_change';
                msg.access_token = window.web_config.token;
                var _list = my_store('downloadEquipData') || {};
                _list[msg.msg_id] = msg;
                _this.downLoadList = _list;
                my_store('downloadEquipData', _this.downLoadList);
                _this.show_loading_key = true;
                window.socket.emit('downEquipData', msg);

            },
            end_down: function (json) {//下载队列完成
                var _this = this;
                if (!json.result) {
                    _this.$Message.error('下载失败');
                }
                var _list = my_store('downloadEquipData') || {};
                _list[json.msg_id].down_status = json.result ? 'singleDown_status' : 'singleDown_reloading';
                if (json.url) {
                    _list[json.msg_id].url = json.url;
                }
                _this.downLoadList = _list;
                my_store('downloadEquipData', _list);
                setTimeout(function () {
                    _this.show_list_key = true;
                    if (json.result && json.url) {
                        var url = json.url.slice(1);
                        var a = window.open('/2.2.05_P001/base_api' + url);
                        console.log(a);
                    }
                }, 200);
            }
        },
        events: {
            hideOverlay: function () {
                if (this.show_loading_key) {
                    this.show_loading_key = false;
                }
            }
        }
    });
</script>




	<left></left>
	
	<div id="content">
		<router-view  keep-alive transition-mode="out-in"></router-view>
	</div>

	<template id="left_template">
	<div id="left" v-cloak>
		<ul>
			<li class="integrated permissionHidden" v-link="{path:'/integrated'}" v-permission="{name:'综合管理'}" v-cloak>
				<a>
					<span></span>
					{{language.left_integrated}}
				</a>
			</li>
			<li class="capsule permissionHidden"  v-if="capsule=='1'" v-link="{path:'/capsule'}" v-permission="{name:'智能囊匣'}">
				<a>
					<span></span>
					智能囊匣
				</a>
			</li>
			<li class="monitoring permissionHidden" v-link="{path:'/environment'}" v-permission="{name:'环境监控'}">
				<a>
					<span></span>
					{{language.left_environmentalMonitor}}
				</a>
			</li>
			<li class="vibration permissionHidden" v-if="vibration=='1'" v-permission="{name:'震动监测'}">
				<a href="../vibration">
					<span></span>
					震动监测
				</a>
			</li>
			<li class="relic_ permissionHidden" v-link="{path:'/relic'}" v-permission="{name:'文物管理'}">
				<a>
					<span></span>
					{{language.left_relicManagement}}
				</a>
			</li>
			<li class="equipment permissionHidden" @click="equipManage()" v-permission="{name:'设备管理'}">
				<a>
					<span></span>
					{{language.left_equipManagement}}
				</a>
			</li>
		</ul>
	</div>
</template>
							<!--左边侧栏-->
	<template id="integratedTemplate">
    <div class="Integrated">
        <div class="header">
            <div class="title" v-text="title" @click="comeBack" :style={cursor:((partName&&!searchValue)?'pointer':'')}
                 :class="{change:(partName&&!searchValue)}"></div>
            <input class="searchBox" type="text" placeholder="请输入环境名称" v-model="searchValue">
            <div class="ability">
                <div class="permissionHidden" v-permission="{name:'设置环境'}"><a href="../setting/#/env">设置环境</a>
                </div>
            </div>
            <!--<div class="ability">-->
            <!--<div @click="export_Integrated">数据导出</div>-->
            <!--</div>-->
            <!--<Modal-->
            <!--:visible.sync="modal_export"-->
            <!--title="环境数据导出"-->
            <!--&gt;</Modal>-->
        </div>

        <div id="Integrated">
            <div id="Integrated_left" class="content">
                <!--style="border: 1px solid deepskyblue"-->
                <div class="viewBox" @scroll="scroll('left')">
                    <div class="specialWrap">
                        <div class="scrollBox clear">
                            <div class="allViewWrap" v-show="!partName&&!searchValue">
                                <div class="floor atten" id="atten" v-show="attention">
                                    <p class="titleNoProper">关注</p>
                                    <p class="title" @click.stop.prevent="setName('关注','follow')"
                                       v-show="all_envs_data.follow && all_envs_data.follow.rows && all_envs_data.follow.rows.length === 0 ? false : true">
                                        更多 > </p>
                                    <div class="boxList clear">
                                        <each-box v-for="region in attention" :part-type="partName" typekey="attention"
                                                  :region="region"></each-box>
                                    </div>
                                </div>
                                <template v-for="(name,obj) in allData">
                                    <div class="floor" v-for="(floorName,floorObj) in obj"
                                         v-show="floorObj.length!==0">
                                        <p class="titleNoProper" v-text="floorObj.name"></p>
                                        <p class="title" @click="setName(floorObj.name,floorObj.env_no,floorName)" v-text="configLanguage.integrated_more + ' >'" v-show="floorObj.rows.length!=0"></p>
                                        <div class="boxList clear" v-if="floorObj.rows.length">
                                            <each-box v-for="region in floorObj.rows" :part-type="partName"
                                                      :region="region"></each-box>
                                        </div>
                                        <div class="boxList clear" v-else>
                                            <each-box :part-type="partName"
                                                      :region="floorObj"></each-box>
                                        </div>
                                    </div>
                                </template>
                                <div class="floor" v-if="other">
                                    <p class="titleNoProper">其他</p>
                                    <p class="title" @click.stop.prevent="setName('其他','other')" v-text="configLanguage.integrated_more + ' >'"></p>
                                    <div class="boxList clear">
                                        <each-box v-for="region in other" :part-type="partName"
                                                  :region="region"></each-box>
                                    </div>
                                </div>
                            </div>
                            <!--进入展厅-->
                            <div class="partViewWrap" v-show="partName&&!searchValue" >
                                <template  v-for="(name,obj) in partData">
                                    <div class="floor" v-if="env_no!='follow'" >
                                        <p class="titleNoProper" v-text="obj.name"></p>
                                        <!-- <p class="title" @click.stop.prevent="hrefFloor(obj.name)" v-text="configLanguage.integrated_more + ' >'"></p> -->
                                        <div class="boxList" v-if="obj.children.length" >
                                            <each-box v-for="region in obj.children" :part-type="partName"
                                                      :region="region"></each-box>
                                        </div>
                                        <div class="boxList" v-else>
                                            <each-box  :part-type="partName"
                                                       :region="obj"></each-box>
                                        </div>
                                    </div>
                                    <each-box v-else  :part-type="partName"
                                              :region="obj" style="margin-top: 17px" ></each-box>
                                </template>
                            </div>
                            <!--搜索-->
                            <div class="The_search_results" v-show="searchValue">
                                <each-box v-for="region in concatArr|filterBy searchValue in 'name' "
                                          :part-type="partName" :region="region"></each-box>
                            </div>
                        </div>
                    </div>
                    <div class="drag"></div>
                    <div class="shadow leftShadow" v-show="partName&&!partData"></div>
                </div>
                <div id="Integrated_right" class="content">
                    <div class="viewBox" @scroll="scroll('right')">
                        <div class="scrollBox clear">
                            <div class="panoramic pieces">
                                <div class="partPanoramic" :class="weatherType">
                                    <p>
                                        <span class="timer">{{weather.today}}</span>
                                        <span class="detail" @click="jumpPage">详情 > </span>
                                        <span class="timeDetail" style="display: block" v-text="detailTimes"></span>
                                    </p>
                                    <font class="gifShadow"></font>
                                    <div class="left_content con">
                                        <div class="img"></div>
                                        <div v-if="from =='网络数据'" class="quality"
                                             :class="{'optimal':isOptimal,'good':isGood,'mild':isMild,'moderate':isModerate,'severe':isSevere,'serious':isSerious,'havent':isHavent}">
                                            {{weather.aqi.level}}
                                        </div>
                                        <!--<div class="optimal">{{weather.aqi.level}}</div>-->
                                    </div>
                                    <div class="right_content con">
                                        <div>
                                            <p class="imghave"><span>{{weather.temperature.val}}°C</span></p>
                                            <p class="imghave two"><span>{{weather.humidity.val}}%</span></p>
                                        </div>
                                        <div>
                                            <p class="font"><span>PM2.5</span><span>{{weather.pm25.val}} μg/m³</span>
                                            </p>    <!--500-->
                                            <p class="view"><span :style="{width:pm25_width}"></span></p>
                                        </div>
                                        <div>
                                            <p class="font"><span>PM1.0</span><span>{{weather.pm10.val}} μg/m³</span>
                                            </p>    <!--500-->
                                            <p class="view"><span :style="{width:pm10_width}"></span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="comprehensive clear">
                                    <div class="wind"
                                         v-if="hideWeather.wind.wind_direction.level&&hideWeather.wind.wind_speed.val">
                                        {{hideWeather.wind.wind_direction.level}}</br><span class="color">{{hideWeather.wind.wind_speed.val}}m/s</span>
                                    </div>
                                    <div :class="type" v-for="(type,obj) in hideWeather"
                                         v-show="type!='wind'&&obj!=''&&obj" :data-title="obj.name">
                                        {{obj.val}}</br><span class="color">{{obj.unit}}</span>
                                    </div>
                                </div>
                                <div class="extension"></div>
                            </div>
                            <div class="Temperature_and_humidity pieces">
                                <h3><span v-text ="configLanguage.integrated_yestodayTemHum"></span></h3>
                                <div class="view_temperature box">
                                    <div class="typeName"><span v-text="configLanguage.common_temperature"></span>
                                        <hr>
                                    </div>
                                    <p class="color"><span class="extreme">极大</span><span class="num"
                                                                                          :class="equalClass(Temperature_and_humidity_extremum.temperature.max.mark)">{{Temperature_and_humidity_extremum.temperature.max.val}}°C</span><span
                                            class="time">{{Temperature_and_humidity_extremum.temperature.max.time}}</span><span
                                            class="floor">{{Temperature_and_humidity_extremum.temperature.max.env_name}}</span>
                                    </p>
                                    <p class="color"><span class="extreme">极小</span><span class="num"
                                                                                          :class="equalClass(Temperature_and_humidity_extremum.temperature.min.mark)">{{Temperature_and_humidity_extremum.temperature.min.val}}°C</span><span
                                            class="time">{{Temperature_and_humidity_extremum.temperature.min.time}}</span><span
                                            class="floor">{{Temperature_and_humidity_extremum.temperature.min.env_name}}</span>
                                    </p>
                                </div>
                                <div class="view_humidity box">
                                    <div class="typeName"><span v-text="configLanguage.common_humidity"></span>
                                        <hr>
                                    </div>
                                    <p class="color"><span class="extreme">极大</span><span class="num"
                                                                                          :class="equalClass(Temperature_and_humidity_extremum.humidity.max.mark)">{{Temperature_and_humidity_extremum.humidity.max.val}}%</span><span
                                            class="time">{{Temperature_and_humidity_extremum.humidity.max.time}}</span><span
                                            class="floor">{{Temperature_and_humidity_extremum.humidity.max.env_name}}</span>
                                    </p>
                                    <p class="color"><span class="extreme">极小</span><span class="num"
                                                                                          :class="equalClass(Temperature_and_humidity_extremum.humidity.min.mark)">{{Temperature_and_humidity_extremum.humidity.min.val}}%</span><span
                                            class="time">{{Temperature_and_humidity_extremum.humidity.min.time}}</span><span
                                            class="floor">{{Temperature_and_humidity_extremum.humidity.min.env_name}}</span>
                                    </p>
                                </div>
                            </div>
                            <div class="Equipment_generalization pieces">
                                <h3><span v-text="configLanguage.integrated_equipSituation"></span></h3>
                                <p class="cumulative">累计收到监测数据</p>
                                <div class="accumulated_data">
                                    <changes-digital :num="data_total"><span class="last">条</span></changes-digital>
                                </div>
                                <div>
                                    <!--<p class="allData"><span>设备类型统计</span></br>{{Equipment_status.equip_total||0}}个</p>-->
                                    <p class="norma"><span>所有设备</span></br>{{Equipment_status.equip_total||0}}个</p>
                                    <p class="backup"><span>传感器</span></br>{{Equipment_status.sensor||0}}个</p>
                                    <p class="stop"><span>调控设备</span></br>{{Equipment_status.controller||0}}个</p>
                                    <p class="other"><span>网络设备</span></br>{{Equipment_status.network||0}}个</p>
                                </div>
                            </div>
                            <div class="Cultural_relics_generalization pieces">
                                <h3><span  v-text="configLanguage.integrated_relicSituation"></span></h3>
                                <div>
                                    <p class="allRelic"><span>文物总数</span></br>{{Cultural_relics_survey.total||0}}个</p>
                                    <p class="norRelic"><span>在展文物</span></br>{{Cultural_relics_survey.show||0}}个</p>
                                    <p class="oldRelic"><span>库藏文物</span></br>{{Cultural_relics_survey.store||0}}个</p>
                                </div>
                            </div>
                            <p v-show="feed">没有我想要的数据？ <span @click="feedback">点我反馈</span></p>
                            <div class="pieces feedBox" :translation="expand" v-else>
                                <textarea class="Feedback_information" style="resize:none;" placeholder="请输入反馈信息"
                                          v-model="textareaVal"></textarea>
                                <p><span class="cancel" @click="feedCancel">取消</span><span class="OK"
                                                                                           @click="feedSubmit">提交</span>
                                </p>
                            </div>
                        </div>
                        <div class="drag"></div>
                    </div>
                </div>
            </div>
            <div class="shadow wholeShadow" v-show="!attention"></div>
        </div>
    </div>
</template>

<template id="eachBox">
    <div class="eachBox" :class="region.env_no" @click="browse(region.env_no)">
        <!--<img :src="region.image" alt="">-->
        <div class="bgImg"
             :style="{background: 'url('+(region.image||'/uploads/no_pic.png')+') no-repeat center'}"></div>
        <span class="attention_to_cancel" @click.stop="attention(region.env_no)" v-if="!region['关注']">关注</span>
        <span class="attention_to_cancel" @click.stop="cancelAttention(region.env_no)" v-else>取消关注</span>
        <div class="footer_information">
            <p class="floor_name ellipsis" v-text="region.name"></p>
            <span v-text="temperature_humidity(region.temperature)" class="temperature"></span>
            <span v-text="temperature_humidity(region.humidity)" class="humidity"></span>
        </div>
    </div>
</template>
			<!--综合管理-->
	<template id="capsule_template">
	<div>
		<div class="header">
			<div class="title" v-text="contentName"></div>
			<div class="select" @mouseenter="mouseenter_($event)" @mouseleave="mouseleave($event)">
				<span class="now">全部</span>
				<ul class="selectBox">
					<li @click.stop="filter('','全部')"  @mouseenter="mouseenter($event)" @mouseleave="mouseleave($event)">全部</li>
					<li v-for="floor in filterContent" :key="$index+2" @mouseenter="mouseenter($event)" @mouseleave="mouseleave($event)" @click.stop="filter(floor.env_no,floor.name)">
						{{floor.name}}
						<ul class="childList">
							<li v-for="layer in floor.children" :key="$index+1" @mouseenter="mouseenter($event)" @mouseleave="mouseleave($event)" @click.stop="filter(layer.env_no,layer.name)">
								{{layer.name}}
								<ul class="childList">
									<li v-for="hall in layer.children" @click.stop="filter(hall.env_no,hall.name)">{{hall.name}}</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</div>
			<div class="overview">
				<p>当前报警 <span v-text="police"></span></p>
				<p>智能囊匣 <span v-text="capsule"></span></p>
			</div>
		</div>
		<div class="capsuleBox" @scroll="scroll">
			<div class="wrap">
				<equip v-for="data in arrList" :data="data" :show-Key.sync="showKey"></equip>
			</div>
			<div class="drag"></div>
			<div v-show="!arrListLength" class="notData">此环境无数据</div>
		</div>
		<div class="contentFooter" v-text="footer" v-show="showfooter"></div>
		<remove-tooltip v-show="showKey" :show-Key.sync="showKey" ></remove-tooltip>
		<div class="shadow" v-show="showKey"></div>
	</div>
</template>

<!--当前子组件-->
<template id="equip">
	<div class="equip" :class="data.env_no">
		<div class="options"><p class="left"></p><p class="right"><span class="remove" @click="showAdd(data.env_no)" v-show="data.alert"></span></p></div>
		<div class="equipView">
			<img :src="data.map||'images/default.png'">
			<p class="equipName text-nowrap" v-text="data.name"></p>
			<span class="equipLocation" v-text="(data.nav&&data.nav.length!==0)?data.nav[0].name+'>'+data.nav[1].name:'*'"></span>
		</div>
		<div class="footer">
			<p><span class="humidityTitle">{{data.humidity||'-'}}%</span></p>
			<p><span class="temperatureTitle">{{data.temperature||'-'}}℃</span></p>
		</div>
		<div class="tip move_alert" v-if="data.alert=='异常震动'">
			<div class="abnormal">异常震动</div>
		</div><!--振动-->
		<div class="tip box_open_alert" v-if="data.alert=='非法开盖'">
			<div class="abnormal">非法开盖</div>
		</div><!--非法-->
		<div class="tip temperature" v-if="data.alert=='temperature'">
			<div class="abnormal">温度超标
				<p><span v-text="data.temperature+'℃'"></span></br><span v-text="judge+'℃'"></span></p>
			</div>
		</div><!--温度超标-->
		<div class="tip humidity" v-if="data.alert=='humidity'">
			<div class="abnormal">湿度超标
				<p><span v-text="data.humidity+'%'"></span></br><span v-text="judge+'%'"></span></p>
			</div>
		</div><!--湿度超标-->
	</div>
</template>


<!--清除时提醒-->
<template id="removeTooltip">
	<div class="alertBox remove">
		<div class="header">清除警报<div class="close" @click="close"></div></div>
		<div class="alert information">
			<h6>报警囊匣</h6>
			<p v-text="data.name"></p>
			<h6>报警类型</h6>
			<p v-text="data.alert_param"></p>
			<h6>报警起始时间</h6>
			<p v-text="data.alert_time"></p>
		</div>
		<div class="alert information">
			<h6>备注</h6>
			<textarea v-model="text"></textarea>
		</div>
		<div class="over" @click="clearAleart">清除警报</div>
	</div>
</template>
				<!--智能囊匣-->

	<!--环境监控-->
	<template id="environmental_monitoring">
	<div class="environmental_monitoring">
		<div class="header">
			<div class="title" v-text="configLanguage.left_environmentalMonitor_long"></div>
			<div class="ability">
				<div @click="Export_data(false)" class="permissionHidden" style="display: none;" v-permission="{name:'导出环境数据'}" >导出数据</div>
				<div class="operationWrap noPointer" @click="contrast">
					{{configLanguage.environment_monitoring_environmentCompare}}
					<!--<ul class="operation" v-show="checkList.length>0">-->
						<!--<li style="max-height:200px;overflow-y:scroll">-->
							<!--<p  v-for="obj in checkList" track-by="$index">{{obj.name}}<span class="fork" @click="eliminate(obj.env_no)"></span>-->
							<!--</p>-->
						<!--</li>-->
						<!--<li class="warning" v-show="checkList.length>=11">*您最多可以选择10个环境进行对比</li>-->
						<!--<li class="center"><div class="start" @click="contrast">开始对比</div></li>-->
					<!--</ul>-->
				</div>
				<!--<div class="operationWrap permissionHidden" v-permission="{name:'阈值报警'}"  @click="Environmental_levels">-->
					<!--{{configLanguage.environment_monitoring_environmentWarning}}-->
					<!--<ul class="operation">-->
						<!--<li v-for="obj in Threshold_alarm.rows"  @click="browse(obj.env_no,obj.env_name)">{{obj.env_name}}<span>{{obj.count}}</span></li>-->
						<!--<li class="center"><div class="start" @click="Environmental_levels">进入环境报警列表</div></li>-->
					<!--</ul>-->
				<!--</div>-->
				<!--<div class="operationWrap">{{configLanguage.integrated_more}}<span class="dragImg"></span>-->
					<!--<ul class="operation">-->
						<!--<li class="permissionHidden" v-permission="{name:'导出报告'}" @click="export_reports">导出报告</li>-->
						<!--<li class="permissionHidden" v-permission="{name:'导出环境数据'}" @click="export_data(true)">导出概览表</li>-->
						<!--&lt;!&ndash;<li style="display: none;">设置阈值</li>&ndash;&gt;-->
						<!--&lt;!&ndash;<li style="display: none;">设置表格</li>&ndash;&gt;-->
						<!--&lt;!&ndash;<li style="display: none;">设置环境</li>&ndash;&gt;-->
					<!--</ul>-->
				<!--</div>-->
				<!--<div class="operationWrap permissionHidden" v-permission="{name:''}"  @click="export_reports">-->
					<!--导出报告-->
				<!--</div>-->
				<div class="operationWrap permissionHidden" v-permission="{name:''}"  @click="export_data(true)">
					导出概览表
				</div>
				<div class="operationWrap permissionHidden" v-permission="{name:''}"  @click="assessment_reports">
					评估报告
				</div>
			</div>
			<Modal
			:visible.sync="export_report"
			title="导出报告"
			@on-ok="report_ok"
			@on-cancel="report_cancel"
			>
				<!--<p>-->
					<!--<span class="report_name">选择年份</span>-->
					<!--<Date-picker type="year" placeholder="选择年" style="width: 200px"  :value.sync="quarter"></Date-picker>-->
				<!--</p>-->
				<!--<p>-->
					<!--<span class="report_name">选择季度</span>-->
					<!--<div>-->
						<!--<Checkbox-group :model.sync="checkGroup">-->
							<!--<Checkbox value="第一季度"></Checkbox>-->
							<!--<Checkbox value="第二季度"></Checkbox>-->
							<!--<Checkbox value="第三季度"></Checkbox>-->
							<!--<Checkbox value="第四季度"></Checkbox>-->
						<!--</Checkbox-group>-->
					<!--</div>-->
				<!--</p>-->
				<!--<i-select :model.sync="model1" style="width:200px">-->
					<!--<i-option v-for="item in report_data" :value="item.value">{{ item.label }}</i-option>-->
				<!--</i-select>-->
				<i-table :content="self" :columns="columns1" :data="data_report"></i-table>
			</Modal>
			<Modal
					:visible.sync="assessment_report"
					title="评估报告"
                    class-name="assessment_report"
                    :mask-closable="false">
				<!--<table>-->
					<!--<tr v-for="obj in report_list.rows">-->
						<!--<td><Icon type="archive" style="font-size: 20px;padding-right: 10px;cursor: pointer;" @click="fileDown(obj.report_file)"></Icon></td>-->
						<!--<td>{{obj.report_name}}</td>-->
					<!--</tr>-->
				<!--</table>-->
				<i-table :content="self" :columns="columns_list" :data="report_list" :show-header="false"  ></i-table>
				<div style="margin: 10px;overflow: hidden">
					<div style="float: right;">
						<Page :total="report_total" :current="report_page" :page-size="report_size" @on-change="changePage"></Page>
					</div>
				</div>
			</Modal>
			<div class="diy">
				<Date-picker type="datetimerange" format="yyyy-MM-dd HH:mm" class="timePicker" :value.sync="timeArr" placeholder="选择日期和时间" :clearable="false" :options="timePickerOption" style="width: 300px" @on-change="changeTime" placement="bottom-end" :editable="false" @on-clear="resetTime" @on-ok="requireData" @on-open-change="saveOldTime"></Date-picker>
				<!--<input placeholder="请输入日期" v-model="pick_time.start" class="start_time laydate-icon" @click="openTimePicker('start')" > 至-->
				<!--<input placeholder="请输入日期" v-model="pick_time.end" class="end_time laydate-icon" @click="openTimePicker('end')" >-->
				<!--<div class="button">确定</div>-->
			</div>
		</div>
		<div class="body">
			<div class="tableBox">
				<div class="shadow"></div>
				<div class="tableBox_shadow" :style="{width:oneTable+'px'}"></div>
				<table border="1px" class="table _content oneTable">
					<thead>
						<tr>
							<td class="one_location" :class="{active:select}" @click="selectAll"></td>
							<td class="function">
								<!--<div v-show="false">-->
									<!--<span class="floatL searchKey"></span>-->
									<!--<div class="floatL">-->
										<!--<div class="floatL hidden_function">-->
											<!--<input type="text">-->
										<!--</div>-->
										<!--<div class="spanWrap">-->
											<!--<span class="allWheae">所有位置</span><span class="selected">已选[{{trSelect}}]</span>-->
										<!--</div>-->
									<!--</div>-->
								<!--</div>-->
								<div>
									<span class="floatL searchKey" @click="switch"></span>
									<div class="floatL spanShow" :class="{active:spanShowKey}">
										<div class="floatL hidden_function">
											<input type="text" placeholder="请输入环境名称" v-model="keyword" @focus="focus" @blur="blur" @keydown.enter="keySearch($event)" @keydown.prevent.up="keyUP" @keydown.prevent.down="keyDOWN"/>
											<div class="operation" v-show="keyword&&status">
												<ul id="searchUl">
													<!--v-for="(num,obj) in fileterContent | filterBy keyword in 'name'"-->
													<li v-for="(num,obj) in filteredSearchList" :class="{active:(who===num)}" @click.stop.prevent="search(obj.name,obj.env_no)" v-html="fileter_keyword(obj.name,keyword)"></li>
												</ul>
											</div>
										</div>
										<div class="spanWrap">
											<span class="allWheae" :class="{active:showType}" @click="toggleType(true)">所有位置</span><span class="selected" :class="{active:!showType}" @click="toggleType(false)">已选[{{trSelect}}]</span>
										</div>
									</div>
								</div>
							</td>
							<td class="function">
								<div class="widthLimit data">
									<span class="temperature"><i ></i>阈值℃</span>
								</div>
							</td>
							<td>极小值℃</td>
							<td>极大值℃</td>
							<td>平均值℃</td>
							<td>达标率%</td>
							<!--<td class="four___">离散系数%</td>-->
							<td class="function">
								<div class="widthLimit data">
									<span class="humidity"><i></i>阈值%</span>
								</div>
							</td>
							<td>极小值%</td>
							<td>极大值%</td>
							<td>平均值%</td>
							<td>达标率%</td>
							<!--<td class="four___1">离散系数%</td>-->
						</tr>
					</thead>
					<tbody>
						<tr is="tr_list" 
							v-for="obj in allData" 
							:data="obj" 
							:keyll="true" 
							:tr-List.sync="trList" 
							:tr-Select.sync="trSelect" 
							:selected.sync="selected"
							:top-status.sync="true"
							>
						</tr>
					</tbody>
				</table>
				<!--<table border="1px" class="table _content copy" :style="{width:oneTable+'px'}">-->
					<!--<thead>-->
						<!--<tr>-->
							<!--<td class="one_location" :class="{active:select}" @click="selectAll" :style="{width:one_location+'px'}"></td>-->
							<!--<td class="function two_location">-->
								<!--<span class="floatL searchKey" @click="switch"></span>-->
								<!--<div class="floatL spanShow" :class="{active:spanShowKey}">-->
									<!--<div class="floatL hidden_function">-->
										<!--<input type="text" placeholder="请输入环境名称" v-model="keyword" @focus="focus" @blur="blur" @keydown.enter="keySearch($event)" @keydown.prevent.up="keyUP" @keydown.prevent.down="keyDOWN"/>-->
										<!--<div class="operation" v-show="keyword&&status">-->
											<!--<ul id="searchUl">-->
												<!--&lt;!&ndash;v-for="(num,obj) in fileterContent | filterBy keyword in 'name'"&ndash;&gt;-->
												<!--<li v-for="(num,obj) in filteredSearchList" :class="{active:(who===num)}" @click.stop.prevent="search(obj.name,obj.env_no)">-->
													<!--{{fileter_keyword(obj.name,keyword)}}-->
												<!--</li>-->
											<!--</ul>-->
										<!--</div>-->
									<!--</div>-->
									<!--<div class="spanWrap">-->
										<!--<span class="allWheae" :class="{active:showType}" @click="toggleType(true)">所有位置</span><span class="selected" :class="{active:!showType}" @click="toggleType(false)">已选[{{trSelect}}]</span>-->
									<!--</div>-->
								<!--</div>-->
							<!--</td>-->
							<!--<td class="function three_location">-->
								<!--<div class="widthLimit data">-->
									<!--<span class="temperature"><i></i>阈值℃</span>-->
								<!--</div>-->
							<!--</td>-->
							<!--&lt;!&ndash;<td :style="{width:one___+'px'}">极值℃</td>&ndash;&gt;-->
							<!--<td>极小值℃</td>-->
							<!--<td>极大值℃</td>-->
							<!--<td >平均值℃</td>-->
							<!--<td >达标率%</td>-->
							<!--&lt;!&ndash;<td :style="{width:four___+'px'}">离散系数%</td>&ndash;&gt;-->
							<!--<td class="function four_location">-->
								<!--<div class="widthLimit data">-->
									<!--<span class="humidity"><i></i>阈值%</span>-->
								<!--</div>-->
							<!--</td>-->
							<!--&lt;!&ndash;<td :style="{width:one___1+'px'}">极值%</td>&ndash;&gt;-->
							<!--<td>极小值%</td>-->
							<!--<td>极大值%</td>-->
							<!--<td>平均值%</td>-->
							<!--<td>达标率%</td>-->
							<!--&lt;!&ndash;<td :style="{width:four___1+'px'}">离散系数%</td>&ndash;&gt;-->
						<!--</tr>-->
					<!--</thead>-->
				<!--</table>-->
			</div>
		</div>
	</div>
</template>
<template id="tr_list">
	<tr :class="[{active:trList.indexOf(data.env_no)!=-1},changeName]" v-show="Judge_conditions">
		<td :class="{active:trList.indexOf(data.env_no)!=-1}" @click="selectChange(data.env_no)"></td>
		<td class="name__">
			<p @click="dragDown" class="clear"><span :class="{environment_icon:data.children&&!this.selected,active:ll}"></span></p>
			<p @click="browse(data.env_no,data.name)" class="ellipsis">{{data.name}}<p>
		</td>
		<!--v-text="data.data.temperature&&data.data.temperature.threshold||'-'"-->
		<td>{{checkData(data.data,'temperature','threshold')}}</td>
		<!--v-text="data.data.temperature&&data.data.temperature.extremum||'-'"-->


		<!--<td class="tableCenter">{{checkData(data.data,'temperature','extremum')}}</td>-->
		<td>{{checkData1(data.data,'temperature','min')}}</td>
		<td>{{checkData1(data.data,'temperature','max')}}</td>
		<!--<td>{{checkData1(data.data,'temperature','extremum','high')}}</td>-->
		<!--v-text="data.data.temperature&&data.data.temperature.average||'-'"-->
		<td>{{checkData(data.data,'temperature','average')}}</td>
		<!--v-text="data.data.temperature&&data.data.temperature.standard_reach||'-'"-->
		<td>{{checkData(data.data,'temperature','standard_reach')}}</td>
		<!--v-text="data.data.temperature&&data.data.temperature.cv||'-'"-->
		<!--<td>{{checkData(data.data,'temperature','cv')}}</td>-->
		<!--v-text="data.data.humidity&&data.data.humidity.threshold||'-'"-->
		<td>{{checkData(data.data,'humidity','threshold')}}</td>
		<!--v-text="data.data.humidity&&data.data.humidity.extremum||'-'"-->
		<!--<td>{{checkData(data.data,'humidity','extremum')}}</td>-->

		<td>{{checkData1(data.data,'humidity','min')}}</td>
		<td>{{checkData1(data.data,'humidity','max')}}</td>

		<!--v-text="data.data.humidity&&data.data.humidity.average||'-'"-->
		<td>{{checkData(data.data,'humidity','average')}}</td>
		<!--v-text="data.data.humidity&&data.data.humidity.standard_reach||'-'"-->
		<td>{{checkData(data.data,'humidity','standard_reach')}}</td>
		<!--v-text="data.data.humidity&&data.data.humidity.cv||'-'"-->
		<!--<td>{{checkData(data.data,'humidity','cv')}}</td>-->
	</tr>
	<template v-if="data.children">
		<tr is="tr_list" v-for="obj in data.children"  :data="obj" :keyll.sync="ll" :tr-List.sync="trList" :tr-Select.sync="trSelect" :selected.sync="selected" :top-status.sync="Judge_conditions"></tr>
	</template>
</template>


	<!--环境超标列表-->
	<template id="Environmental_levels">
	<div class="Environmental_levels">
		<div class="header">
			<div class="title">
				<a href="javascript:window.history.go(-1)" class="goBack"><Icon type="chevron-left" style="margin-right: 10px;"></Icon>环境报警</a>
			</div>
			<div class="filterWrap">
				<filter-component type="env_alert"></filter-component>
			</div>
			<div class="ability">
				<div @click="hidePolice" :class="{active:this.post_data.clear==1}">隐藏已处理报警</div>
			</div>
		</div>
		<div class="body">
			<div class="tableBox" style="max-height: 785px;">
				<div class="table_count">
					<table class="table _content">
						<thead>
							<td class="permissionHidden" v-permission="{name:'处理报警'}">处理</td>
							<td>事件ID</td>
							<td>报警环境</td>
							<td>报警设备</td>
							<td>报警文物</td>
							<td>报警时间</td>
							<td>报警参数</td>
							<td>清除报警时间</td>
							<td>情况说明</td>
						</thead>
						<tbody>
							<tr v-for="(index,tr) in table_data.rows">
								<td :style={cursor:tr.clear?'auto':'pointer'} class="permissionHidden" v-permission="{name:'处理报警'}" @click="clearPolice(tr,index)"><span :class="{cleared:tr.clear}"></span></td>
								<td>{{tr.id}}</td>
								<td><a  href="javascript:void(0)" @click="goNavDetail(tr.nav,tr.alert_time,tr.alert_param)">{{location(tr.nav)}}</a></td>
								<td><a  href="javascript:void(0)" @click="goEquipDetail(tr.equip_no,tr.alert_time,tr.equip_type)">{{tr.equip_no}}</a></td>
								<td>{{tr.relic_name}}</td>
								<td>{{tr.alert_time}}</td>
								<!--{{conversion(tr.alert_param)}}-->
								<td :class="tr.alert_param"> {{tr.content}} </td>
								<td>{{tr.clear_time}}</td>
								<td :class="{not_fill:!tr.clear}">{{tr.clear?tr.remark:'待填写'}}</td>
							</tr>
						</tbody>
					</table>
					<div class="shadow" v-show="shadow"></div>
				</div>
				<page-list @turn-page="turnPage" :page.sync="post_data.page" :allPage.sync="allPage" :count="table_data.count"></page-list>
			</div>
			<div class="shadow" v-show="clear"></div>
		</div>
		<div class="fixedShadow" v-show="clear"></div>
		<clear-police transition="alert" v-if="clear" :clear.sync="clear" :clear-data.sync="clearData"></clear-police>
	</div>
</template>

<!-- 清除模板 -->
<template id="clearPolice">
	<div class="alertBox remove">
		<header>
			清除报警
			<Icon type="close-round" size="20" class="close" @click="close"></Icon>
		</header>
		<section>
			<div class="alert information left">
				<h6>报警环境</h6>
				<p>{{clearData.nav}}</p>
				<h6>报警类型</h6>
				<p>{{clearData.type}}</p>
				<h6>报警起始时间</h6>
				<p>{{clearData.time}}</p>
				<h6>关联文物</h6>
				<p>{{clearData.relic}}</p>
			</div>
			<div class="alert information right">
				<h6>备注</h6>
				<textarea v-model="text"></textarea>
			</div>
		</section>
		<footer>
			<div class="btnsContainer">
				<div class="over" @click="clearAlert">清除警报</div>
			</div>
		</footer>
	</div>
</template>

	<!--环境详情-->
	<template id="environment_template">
	<div class="environment">
		<div class="header">
			<div class="title">
				<a href="javascript:window.history.go(-1)"  class="goBack"><Icon type="chevron-left" style="margin-right: 10px;"></Icon>环境详情与对比</a>
			</div>
			<div class="ability">
				<!--<div @click="timeChange">按时间对比</div>-->
				<!--<div>设置阈值</div>-->
				<!--<div class="operationWrap">更多<span class="dragImg"></span>-->
					<!--<ul class="operation">-->
						<!--<li>设置阈值</li>-->
					<!--</ul>-->
				<!--</div>-->
			</div>
			<div class="diy">
				<Date-picker type="datetimerange" format="yyyy-MM-dd HH:mm" class="timePicker" :value="timeArr" placeholder="选择日期和时间" :clearable="false" :options="timePickerOption" style="width: 300px" @on-change="changeTime" placement="bottom-end" :editable="false" @on-clear="resetTime" @on-ok="requireData" @on-open-change="saveOldTime"></Date-picker>
				<!--<input placeholder="请输入日期" v-model="pick_time.start" class="start_time laydate-icon" @click="openTimePicker('start')" > 至-->
				<!--<input placeholder="请输入日期" v-model="pick_time.end" class="end_time laydate-icon" @click="openTimePicker('end')" >-->
				<!--<div class="button">确定</div>-->
			</div>
		</div>
		<div class="body">
			<div class="left_environment">
				<div class="function">
					<span class="floatL searchKey"></span>
					<div class="floatL spanShow">
						<div class="floatL hidden_function">
							<input type="text" placeholder="请输入搜索条件" v-model="filterInput" @keyup.prevent.stop.down="keyDown" @keyup.prevent.stop.up="keyUp" @keyup.prevent.stop.enter="keyEnter($event)">
							<div class="operation" v-show="filterInput">
								<ul id="searchUl">
									<li v-for="(num,obj) in filterContent | filterBy filterInput in 'name'" :class="{active:(who===num)}"  @click="clickSearch(obj.name,obj.env_no)">
										{{filter_filterInput(obj.name,filterInput)}}
									</li>
								</ul>
							</div>
							<div class="clear_env" >
								<span @click="clearEnv()">清空</span>
							</div>
						</div>
						<!--<div class="spanWrap">
							<span class="allWheae active">所有位置</span><span class="selected">已选[0]</span>
						</div>-->
					</div>
				</div>
				<div class="tree_box">
					<tree-list :tree_list="tree_list" :keyword="keyword" :sel_list.sync="sel_env"></tree-list>
				</div>
			</div>
			<div class="right_environment">
				<p class="title" v-show="sel_env==''?false:true">
					<span :class="{active:com=='environment_curve'}" @click="check_component('curve')">监测曲线</span>
					<span :class="{active:com=='environment_data'}"  @click="check_component('data')">原始数据</span>
					<span :class="{active:com=='environment_relic'}"  @click="check_component('relic')">文物</span>
					<span :class="{active:com=='environment_equipment'}"  @click="check_component('equipment')">设备</span>
					<span :class="{active:com=='environment_map'}"  @click="check_component('map')">地图</span>
				</p>
				<!--<div class="shadow" v-show="shadowKey" :style="{height:shadowHeight+'px'}"></div>-->
				<component :is="com" :time.sync="timeStr" :envs.sync="envs" :shadow-key.sync="shadowKey" :env_name.sync="env_name" :in_detail_b:sync="inDetailB" :has_envs.sync="hasEnvs"  keep-alive  v-if="sel_env==''?false:true"></component>
					<p  class="hintMsg" v-if="envsShow" >请选择环境</p>
			</div>
		</div>
	</div>
</template>


<template id="environment_curve">
    <div class="curve_content">
        <div class="filter_box clear">
            <p><font style="margin-right:5px">环境参数 :</font>
                <span @click="save_delete(name)" :class="[name,{active:save_param.indexOf(name)!=-1}]"
                      v-for="name in param" :style="{border:borderStyle(save_param.indexOf(name))}">
                    {{changeName(name)}}
                    <!--<i></i>-->
                </span>
            </p>
            <p><font style="margin-right:5px">图表类型 :</font>
                <select name="" id="">
                    <option value="">监测曲线</option>
                </select></p>
        </div>
        <div class="diyButton">
            <i-button type="ghost" class="diyYAxis" v-show="save_param.length!=0" @click="showModal">
                自定义Y轴
            </i-button>
        </div>
        <div class="filter_content" v-show="envs&&envs.length!=0">
            <div class="tabContainer" v-show="switchBtn&&save_param.length!=0">
                <span class="img" @click="switchImgTable('img')" :class="{active:switchCurr==='img'}">图</span>
                <span class="table" @click="switchImgTable('table')" :class="{active:switchCurr==='table'}">表</span>
            </div>
            <div class="echarts_container" v-show="switchCurr==='img'"></div>
            <div class="table_container" v-show="switchCurr==='table'&&save_param.length!=0">
                <div class="tableWarp">
                    <!--显示表格-->
                    <table class="cardTable" :width="cardTableWidth">
                        <thead>
                        <tr>
                            <th rowspan="2" width="150" height="50">
                                位置
                            </th>
                            <th v-for="(param,types) in tableHead" track-by="$index" colspan="8">
                                {{param}}<br/>
                                <span style="color:#adb8bc;font-size: 10px;">({{cnUnit[param]}})</span>
                            </th>
                        </tr>
                        <tr>
                            <template v-for="(param,types) in tableHead">
                            <th v-for="item in types">
                                {{item}}
                            </th>
                            </template>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="env in data_eigenvalue_sort">
                            <td>
                                {{env.env_name}}
                            </td>
                            <template v-for="(param,types) in tableHead">
                                <td v-for="type in types">
                                    {{env[param][type]}}
                                </td>
                            </template>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="shadow tableShadow"></div>
            </div>

            <div class="card_show" v-show="envs" v-cloak>
                <div class="envThreshold" v-for="(env_no,env) in envThresholdData">
                    <div class="thresholdHeader">
                        <h4>
                            <span class="envName">{{env.name}}</span>
                            <div class="lockStatus permissionHidden" v-permission="{name:'修改阈值'}">
                                <Icon class="left" type="locked" v-show="env.lock==1" @click="changeLockStatus(env_no)"></Icon>
                                <Icon type="unlocked" v-show="env.lock==0" @click="changeLockStatus(env_no)"></Icon>
                            </div>
                            <div class="editEnvThreshold permissionHidden" v-permission="{name:'修改阈值'}">
                                <Icon type="edit" v-show="!inEdit[env_no]" :class="{disabled:env.lock==1}" @click="editEnvThreshold(env_no)"></Icon>
                                <!--<Icon type="chevron-right" :class="{collapse:!envCollapse}"-->
                                      <!--@click="collapseEnvThreshold"></Icon>-->
                            </div>
                        </h4>
                        <!--v-show="!envCollapse" transition="collapse"-->
                        <div class="envThresholdContent">
                            <section>
                                <Row v-for="(key,item) in env"  :style="editStyle(env_no)" v-show="item&&((item.max&&item.max!='')||(item.min&&item.min!=''))||inEdit[env_no]">
                                    <template v-if="key!='type'&&key!='no'&&key!='lock'&&key!='name'">
                                        <i-col span="10">
                                            <div style="white-space: normal">{{item.name}}</div>
                                        </i-col>
                                        <i-col span="14">
                                            <Row v-if="item.min||item.min==''">
                                                <i-col span="11" class="center">
                                                    <span v-show="!inEdit[env_no]">{{item.min}}</span>
                                                    <i-input size="small" v-show="inEdit[env_no]" :value.sync="item.min" class="wide" :class="{error:thresholdValidate[env_no][key+'min']}" @on-change="validateThreshold(env_no,key,item,'min')"></i-input>
                                                    <div class="errorMessage" v-show="thresholdValidate[env_no][key+'min']">{{thresholdErrorMsg[env_no][key+'min']}}</div>
                                                </i-col>
                                                <i-col span="2" class="center">~</i-col>
                                                <i-col span="11" class="center">
                                                    <span v-show="!inEdit[env_no]">{{item.max}}{{item.unit}}</span>
                                                    <i-input size="small" v-show="inEdit[env_no]" :value.sync="item.max" class="wide" :class="{error:thresholdValidate[env_no][key+'max']}" @on-change="validateThreshold(env_no,key,item,'max')"></i-input>
                                                    <div class="errorMessage" v-show="thresholdValidate[env_no][key+'max']">{{thresholdErrorMsg[env_no][key+'max']}}</div>
                                                </i-col>
                                                <!--<i-col span="7" class="center">{{item.unit}}</i-col>-->
                                            </Row>
                                            <Row v-else>
                                                <i-col span="2" class="right">&le;</i-col>
                                                <i-col span="22" class="center">
                                                    <span v-show="!inEdit[env_no]">{{item.max}}{{item.unit}}</span>
                                                    <i-input size="small" v-show="inEdit[env_no]" :value.sync="item.max" class="wide" :class="{error:thresholdValidate[env_no][key+'max']}" @on-change="validateThreshold(env_no,key,item,'max')"></i-input>
                                                    <div class="errorMessage" v-show="thresholdValidate[env_no][key+'max']">{{thresholdErrorMsg[env_no][key+'max']}}</div>
                                                </i-col>
                                                <!--<i-col span="7" class="center">{{item.unit}}</i-col>-->
                                            </Row>
                                        </i-col>
                                    </template>
                                </Row>
                            </section>
                            <footer v-show="inEdit[env_no]" class="btns">
                                <i-button type="info" @click="submitEdit(env_no)">确定</i-button>
                                <i-button type="ghost" @click="cancelEdit(env_no)">取消</i-button>
                            </footer>
                        </div>
                    </div>
                    <!--这里是一个可折叠的tab,显示环境阈值信息-->
                </div>
                <!--原卡片显示环境特征值-->
                <!--<div class="card first" :style="{height:env_name.length>1?87+'px':47+'px'}">-->
                    <!--<div class="name_box">-->
                        <!--<p class="name">特征值名称</p>-->
                    <!--</div>-->
                    <!--<p class="name_detail ellipsis">-->
                        <!--<font class="ellipsis" v-for="name in env_name" track-by="$index">{{name}}<br/></font>-->
                        <!--<span v-show="env_name.length>1"></span>-->
                    <!--</p>-->
                <!--</div>-->
                <!--<template v-for="(name,obj) in data_eigenvalue_sort">-->
                    <!--<div class="card" v-for="(key,arr) in obj" :class="name"-->
                         <!--:style="{height:env_name.length>1?87+'px':47+'px'}" v-show="save_param.indexOf(name)!=-1">-->
                        <!--<div class="name_box">-->
                            <!--<p class="name">{{changeName(name)+changeType(key)}}</p>-->
                        <!--</div>-->
                        <!--<p class="name_detail ellipsis">-->
                            <!--<font v-for="num in arr" track-by="$index">{{num}}<br/></font>-->
                            <!--<span v-show="env_name.length>1"></span>-->
                        <!--</p>-->
                    <!--</div>-->
                <!--</template>-->
            </div>
            <div class="shadow coverAll"></div>
        </div>
        <Modal
                title="自定义Y轴"
                :visible.sync="showDiyModal"
                :mask-closable="false"
                @on-ok="changeY"
                @on-cancel="cancelChangeY"
        >
            <div class="yAreaContainer">
                <i-form :model="yAreaData" :label-width="90">
                    <form-item v-for="(key,item) in yAreaData" :label="changeName(key)" :prop="key">
                        <row>
                            <i-col span="12">
                                <form-item :prop="key+'min'">
                                    <Radio-group :model.sync="item.status" @on-change="changeYType(key,item.status)">
                                        <Radio value="default">自适应</Radio>
                                        <Radio value="user-defined">自定义</Radio>
                                    </Radio-group>
                                </form-item>
                            </i-col>
                            <i-col span="5" v-show="item.status=='user-defined'">
                                <form-item :prop="key+'min'">
                                    <i-input :value.sync="item.min" :class="{error:!yAreaValidate[key].min}" @on-change="validateY(key,'min',item.min)"></i-input>
                                    <div class="errorMessage" v-show="!yAreaValidate[key].min">{{errorMsg[key].min}}</div>
                                </form-item>
                            </i-col>
                            <i-col span="2" style="text-align: center"
                                   v-show="item.status=='user-defined'">-
                            </i-col>
                            <i-col span="5" v-show="item.status=='user-defined'">
                                <form-item :prop="key+'max'">
                                    <i-input :value.sync="item.max" :class="{error:!yAreaValidate[key].max}" @on-change="validateY(key,'max',item.max)"></i-input>
                                    <div class="errorMessage" v-show="!yAreaValidate[key].max">{{errorMsg[key].max}}</div>
                                </form-item>
                            </i-col>
                        </row>
                    </form-item>
                </i-form>
            </div>
            <div slot="footer">
                <i-button type="primary" @click="changeY">
                    确定
                </i-button>
                <i-button @click="cancelChangeY">
                    取消
                </i-button>
            </div>
        </Modal>
    </div>
</template>

<template id="environment_data">
	<div class="data_content">
		<div class="fliter_box">
			<p>筛选条件 : 
				<span v-for="obj in filter_conditions.environment" @click="filter('environment',obj.name,obj.env_no)">{{obj.name}}</span>
				<span v-for="name in filter_conditions.equip" @click="filter('equip',name)">{{name}}</span>
			</p>
		</div>
		<div class="original_data">
			<table class="table">
				<thead>
					<td><p>时间</p></td>
					<td class="cursor" @mouseenter="change('environment',$event)"  @mouseleave="change('environment',$event)"><p>环境<span class="dragImg"></span></p>
						<ul v-show="environment" class="operation" transition="change" :style="{left:environmentLeft+'px'}">
							<li v-for="(index,name) in env_name" @click="filter('environment',name,env_no_change[index])" track-by="$index">{{name}}</li>
						</ul>
					</td>
					<td class="cursor" @mouseenter="change('equip',$event)"  @mouseleave="change('equip',$event)"><p>设备<span class="dragImg"></span></p>
						<ul v-show="equip" class="operation" transition="change" :style="{left:equipLeft+'px'}">
							<li class="hidden_function function">
								<span class="floatL searchKey"></span>
								<input type="text" placeholder="请输入设备编号" @keydown.enter="searchEquip" v-model="Equipment_serial_number"/>
							</li>
							<template v-for="(name,type) in equip_type">
								<li v-for="name in type" @click="filter('equip',name)">{{name}}</li>
							</template>
						</ul>
					</td>
					<td>温度<br/><span>℃</span></td>
					<td>相对湿度<br/><span>%</span></td>
					<td>光照强度<br/><span>lx</span></td>
					<td>紫外线强度<br/><span>μw/cm²</span></td>
					<td>有挥发染物<br/><span>ppb</span></td>
					<td>二氧化碳<br/><span>ppm</span></td>
					<td>有机污染物<br/><span>Hz</span></td>
					<td>无机污染物<br/><span>Hz</span></td>
					<td>含硫污染物<br/><span>Hz</span></td>
					<td>土壤温度<br/><span>°C</span></td>
					<td>土壤湿度<br/><span>%</span></td>
					<td>土壤含盐量<br/><span>%</span></td>
				</thead>
				<tbody>
					<tr v-for="rows in table_data.rows">
						<td>{{rows.equip_time}}</td>
						<td>{{rows.env_name}}</td>
						<td>{{rows.equip_no}}</td>
						
						<td>{{rows.new_data.temperature}}</td>
						<td>{{rows.new_data.humidity}}</td>
						<td>{{rows.new_data.light}}</td>
						<td>{{rows.new_data.uv}}</td>
						<td>{{rows.new_data.voc}}</td>
						<td>{{rows.new_data.co2}}</td>
						<td>{{rows.new_data.organic}}</td>
						<td>{{rows.new_data.inorganic}}</td>
						<td>{{rows.new_data.sulfur}}</td>

						<td>{{rows.new_data.soil_temperature}}</td>
						<td>{{rows.new_data.soil_humidity}}</td>
						<td>{{rows.new_data.soil_salt}}</td>
					</tr>
				</tbody>
			</table>
			<div class="shadow"></div>
		</div>
		<page-list @turn-page="turnPage" :page.sync="data_params.page" :allPage.sync="allPage" :count="table_data.count"></page-list>
	</div>
</template>

<template id="environment_equipment">
	<div id="equipment">
		<div class="equipment_top">
			<div class="title_label lf">筛选条件 : </div>
			<ul class="filter_condition_list lf" v-for="(key,condition_type) in filter_list">
				<li class="filter_condition_item" v-for="condition in condition_type" @click="change_filter(condition,key)">
					{{condition}}
					<i class="cancel_icon"></i>
				</li>
			</ul>
		</div>
		<div class="table_container">
			<div class="table_dimmer" v-show="equipment_table_data_index!=0">
				<!-- 为table添加一个遮罩层，背景图中心Loading-->
			</div>
			<div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
				<!--<p>这里显示地理位置信息</p>-->
				<div class="view">
					<div class="point" :data-title="nav_name"></div>
					<img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
				</div>
			</div>
			<div class="wrapper">
				<table class="equipment_info_table">
					<thead>
					<tr>
						<th class="equipment_status" @mouseenter="show_filter_condition('equipment_status')" @mouseleave="hide_filter_condition('equipment_status')" width="10%">
							<span>状态<i class="arrow_down"></i></span>
							<div class="status_filter_condition left" v-show="status.equipment_status" @mouseleave="hide_filter_condition('equipment_status')">
								<!--<span class="equipment_status_item normal" @click="change_filter('正常','status')">正常</span>-->
								<!--<span class="equipment_status_item fault" @click="change_filter('故障','status')">故障</span>-->
								<!--<span class="equipment_status_item overproof_very_low_voltage_abnormal" @click="change_filter('超标','status')">超标</span>-->
								<!--<span class="equipment_status_item low_voltage" @click="change_filter('低电','status')">低电</span>-->
								<!--<span class="equipment_status_item overproof_very_low_voltage_abnormal" @click="change_filter('超低电','status')">超低电</span>-->
								<!--<span class="equipment_status_item backup" @click="change_filter('备用','status')">备用</span>-->
								<!--<span class="equipment_status_item disable" @click="change_filter('停用','status')">停用</span>-->
								<!--<span class="equipment_status_item overproof_very_low_voltage_abnormal" @click="change_filter('异常','status')">异常</span>-->

								<span v-for="status in equip_status" :class="['equipment_status_item',status.name]" @click="change_filter(status.name,'status')">
									{{status.name}}
								</span>
							</div>
						</th>
						<th class="equipment_name" width="30%" @mouseenter="show_filter_condition('equipment_name')" @mouseleave="hide_filter_condition('equipment_name')">
							<span>设备名称|设备ID<i class="arrow_down"></i></span>
							<div class="name_filter_condition left" @mouseleave="hide_filter_condition('equipment_name')" v-show="status.equipment_name">
								<div>
									<input type="text" v-model="search_equipment_name" placeholder="输入设备名称或设备ID" @keyup.enter="exact_search(search_equipment_name)"/>
									<span class="search_icon"></span>
									<span class="clear_icon" @click="clear_search_equipment_name"></span>
								</div>
							</div>
						</th>
						<th class="equipment_nav" width="30%" @mouseenter="show_filter_condition('equipment_nav')" @mouseleave="hide_filter_condition('equipment_nav')">
							<span>位置<i class="arrow_down" v-show="env_name.length!=0"></i></span>
							<div class="nav_filter_condition left right" @mouseleave="hide_filter_condition('equipment_nav')" v-show="status.equipment_nav&&env_name.length!=0">
								<ul>
									<li v-for="nav in env_name" track-by="$index" @click="change_filter(nav,'position')" :class="{active:filter_list.position.indexOf(nav)!=-1}">
										{{nav}}
									</li>
								</ul>
							</div>
						</th>
						<th class="equipment_type" width="10%" @mouseenter="show_filter_condition('equipment_type')" @mouseleave="hide_filter_condition('equipment_type')">
							<span>类型<i class="arrow_down"></i></span>
							<div class="equipment_type_filter_condition right" v-show="status.equipment_type">
								<ul class="equipment_type_filter_list">
									<template v-if='equip_type.sensor&&equip_type.sensor.length!=0'>
										<li  v-for="data in equip_type.sensor" class="equipment_type_filter_item sensor rf" :class={active:filter_list.equip_type.indexOf(data)!=-1} @click="change_filter(data,'equip_type')"><span class="equipment_type_icon" :class="{sensor_temperature_humidity:data=='温湿度监测终端',sensor_temperature_humidity_with_screen:data=='带屏温湿度监测终端',sensor_light_uv:data=='光照紫外监测终端',sensor_co2:data=='二氧化碳监测终端',sensor_voc:data=='有机挥发物监测终端',sensor_qcm:data=='空气质量监测终端',sensor_soil_temperature_humidity:data=='土壤温湿度监测终端',sensor_security:data=='安防监测终端',sensor_shock:data=='震动监测终端'}"></span>{{data}}</li>
									</template>
								</ul>
								<ul class="equipment_type_filter_list">
									<li v-if='equip_type.network&&equip_type.network.length!=0' v-for="data in equip_type.network" class="equipment_type_filter_item network rf" :class={active:filter_list.equip_type.indexOf(data)!=-1} @click="change_filter(data,'equip_type')"><span class="equipment_type_icon" :class="{network_gateway:data=='网关',network_relay:data=='中继'}"></span>{{data}}</li>
								</ul>
								<ul class="equipment_type_filter_list">
									<li v-if='equip_type.controller&&equip_type.controller.length!=0' v-for="data in equip_type.controller" class="equipment_type_filter_item controller rf" :class={active:filter_list.equip_type.indexOf(data)!=-1} @click="change_filter(data,'equip_type')"><span class="equipment_type_icon" :class="{controller_humidity_machine:data=='调湿机',controller_lighting:data=='灯光调控终端',controller_humidity_cabinet:data=='充氮调湿柜',controller_humidity_agent:data=='调湿剂',智能展柜:data=='智能展柜'}"></span>{{data}}</li>
								</ul>
								<ul class="equipment_type_filter_list">
									<li v-if='equip_type.offline&&equip_type.offline.length!=0' v-for="data in equip_type.offline" class="equipment_type_filter_item sp_sensor rf" :class={active:filter_list.equip_type.indexOf(data)!=-1} @click="change_filter(data,'equip_type')"><span class="equipment_type_icon" :class="{sensor_offline_temperature_humidity:data=='手持式温湿度检测仪'||data=='固定式温湿度检测仪',sensor_offline_light_uv:data=='手持式光照紫外检测仪',sensor_offline_co2:data=='手持式二氧化碳检测仪'||data=='固定式二氧化碳检测仪',sensor_offline_formaldehyde:data=='手持式甲醛检测仪',sensor_offline_voc:data=='手持式有机挥发物检测仪'}"></span>{{data}}</li>
								</ul>
								<ul class="equipment_type_filter_list">
									<li v-if='equip_type.box&&equip_type.box.length!=0' v-for="data in equip_type.box" class="equipment_type_filter_item sp_sensor rf" :class={active:filter_list.equip_type.indexOf(data)!=-1} @click="change_filter(data,'equip_type')"><span class="equipment_type_icon" :class="{sp_sensor_capsule:data=='智能囊匣'}"></span>{{data}}</li>
								</ul>
							</div>
						</th>
						<th class="equipment_new_data" width="20%">
							最新数据
						</th>
					</tr>
					</thead>
					<tbody>
					<tr v-for="(index,data) in equipment_rows">
						<td class="equipment_status_item">
						<span class="equipment_status_item" :class="{normal:data.status=='正常',fault:data.status=='故障',overproof_very_low_voltage_abnormal:data.status=='超标'||data.status=='超低电'||data.status=='异常',low_voltage:data.status=='低电',backup:data.status=='备用',disable:data.status=='停用'}">
							{{data.status||'无状态信息'}}
						</span>
						</td>
						<td class="equipment_name_no">
							<p style="cursor: pointer" @click="go_equipment_detail(data.equip_no)">
								<span class="equipment_name">{{data.name}}</span><span class="equipment_no">{{data.equip_no}}</span>
							</p>
						</td>
						<td class="equipment_nav">
							<p><span v-if="data.map&&data.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,data.map,data.locate,data)" @mouseleave="hide_big_nav"></span>{{nav_info(data.nav)||'暂无位置信息'}}</p>
						</td>
						<td class="equipment_equip_type">
							<span class="equipment_type_icon" :class="{sensor_temperature_humidity:data.equip_type=='温湿度监测终端',sensor_offline_temperature_humidity:data.equip_type=='手持式温湿度检测仪'||data.equip_type=='固定式温湿度检测仪',sensor_temperature_humidity_with_screen:data.equip_type=='带屏温湿度监测终端',sensor_light_uv:data.equip_type=='光照紫外监测终端',sensor_offline_light_uv:data.equip_type=='手持式光照紫外检测仪',sensor_co2:data.equip_type=='二氧化碳监测终端',sensor_offline_co2:data.equip_type=='手持式二氧化碳检测仪',sensor_offline_formaldehyde:data.equip_type=='手持式甲醛检测仪',sensor_voc:data.equip_type=='有机挥发物监测终端',sensor_offline_voc:data.equip_type=='手持式有机挥发物检测仪',sensor_qcm:data.equip_type=='空气质量监测终端',sensor_soil_temperature_humidity:data.equip_type=='土壤温湿度监测终端',sensor_security:data.equip_type=='安防监测终端',sensor_shock:data.equip_type=='震动监测终端',network_gateway:data.equip_type=='网关',network_relay:data.equip_type=='中继',controller_humidity_machine:data.equip_type=='调湿机',controller_lighting:data.equip_type=='灯光调控终端',controller_humidity_cabinet:data.equip_type=='充氮调湿柜',controller_humidity_agent:data.equip_type=='调湿剂',sp_sensor_capsule:data.equip_type=='智能囊匣监测终端',智能展柜:data.equip_type=='智能展柜'}" :data-title="data.equip_type"></span>
							<!--{{data.equip_type}}-->
						</td>
						<td class="equipment_new_data" @mouseenter="show_more(data.equip_no)" @mouseleave="hide_more(data.equip_no)">
							<Poptip trigger="hover" placement="left">
								<div class="newDataEnd">{{{newDataEnd(data)}}}</div>
								<div class="api" slot="content">
									{{{allNewDataEnd(data)}}}
								</div>
							</Poptip>
							<!--<span class="temperature">-->
								<!--{{data.new_data.temperature||'-'}}{{unit.temperature}}-->
							<!--</span>-->
							<!--<span class="humidity">-->
								<!--{{data.new_data.humidity||'-'}}{{unit.humidity}}-->
							<!--</span>-->
								<!--<span class="more_new_data" v-show="has_other_key(data.new_data,data.equip_no)">-->
								<!--<b>. . .</b>-->
							<!--</span>-->
								<!--<div v-if="has_other_key(data.new_data,data.equip_no)" v-show="more_status[data.equip_no]" class="more_info">-->
									<!--<p v-for="(index,value) in data.new_data" :class="index">-->
										<!--<span v-if="index!='broken'&&index!='vibration'&&index!='multi_wave'">{{value||'-'}}{{unit[index]}}</span>-->
										<!--<span v-if="index=='broken'">玻破警报</span>-->
										<!--<span v-if="index=='vibration'">震动警报</span>-->
										<!--<span v-if="index=='multi_wave'">驻波警报</span>-->
									<!--</p>-->
								<!--</div>-->
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
		<page-list :page.sync="curr_page" :allpage="page_num" :count="total"></page-list>
	</div>
</template>

<template id="environment_relic">
	<div id="relic">
		<div class="relic_top">
			<div class="title_label lf">筛选条件 : </div>
			<ul class="filter_condition_list lf" v-for="(key,condition_type) in filter_list">
				<li class="filter_condition_item" v-for="condition in condition_type" @click="change_filter(condition,key)">
					{{condition}}
					<i class="cancel_icon"></i>
				</li>
			</ul>
		</div>
		<div class="table_container">
			<div class="table_dimmer" v-show="relic_table_data_index!=0">
				<!-- 为table添加一个遮罩层，背景图中心Loading-->
			</div>
			<div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
				<!--<p>这里显示文物图片</p>-->
				<img :src="img_src" :alt="img_src"/>
			</div>
			<div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
				<!--<p>这里显示地理位置信息</p>-->
				<div class="view">
					<div class="point" :data-title="nav_name"></div>
					<img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
				</div>
			</div>
			<div class="wrapper">
				<table class="relic_info_table">
					<thead>
					<tr>
						<th class="relic_status" @mouseenter="show_filter_condition('relic_status')" @mouseleave="hide_filter_condition('relic_status')" width="10%">
							<span>状态<i class="arrow_down"></i></span>
							<div class="status_filter_condition left" v-show="status.relic_status" @mouseleave="hide_filter_condition('relic_status')">
								<span v-for="status in status_list" v-show="status.name" :class="['relic_status_item',status.name]" @click="change_filter(status.name,'status')">{{status.name}}</span>
								<!--<p>-->
									<!--<span class="label">库藏文物</span>-->
									<!--<span class="relic_status_item 不需修复" @click="change_filter('不需修复','status')">不需修复</span>-->
									<!--<span class="relic_status_item 需要修复" @click="change_filter('需要修复','status')">需要修复</span>-->
									<!--<span class="relic_status_item 亟需修复" @click="change_filter('亟需修复','status')">亟需修复</span>-->
								<!--</p>-->
								<!--<p>-->
									<!--<span class="label">离库文物</span>-->
									<!--<span class="relic_status_item 展陈 show" @click="change_filter('展陈','status')">展陈</span>-->
									<!--<span class="relic_status_item 修复 repair" @click="change_filter('修复','status')">修复</span>-->
									<!--<span class="relic_status_item 修复 research" @click="change_filter('科研','status')">科研</span>-->
									<!--<span class="relic_status_item 借调 borrow_out" @click="change_filter('借调','status')">借调</span>-->
								<!--</p>-->
								<!--<p>-->
									<!--<span class="label">它馆借调</span>-->
									<!--<span class="relic_status_item 已归还 return" @click="change_filter('已归还','status')">已归还</span>-->
									<!--<span class="relic_status_item 借入 borrow_in" @click="change_filter('借入','status')">借入</span>-->
								<!--</p>-->
							</div>
						</th>
						<th class="relic_name" @mouseenter="show_filter_condition('relic_name')" @mouseleave="hide_filter_condition('relic_name')" width="30%">
							<span>藏品名称|总登记号<i class="arrow_down"></i></span>
							<div class="name_filter_condition left" @mouseleave="hide_filter_condition('relic_name')" v-show="status.relic_name">
								<div>
									<input type="text" v-model="search_relic_name" placeholder="输入藏品名称或总登记号" @keyup.enter="exact_search(search_relic_name)"/>
									<span class="search_icon"></span>
									<span class="clear_icon" @click="clear_search_relic_name"></span>
								</div>
								<!--<p>-->
								<!--排序: <span :class="{order:order_type=='A-Z'}" @click="change_order_type('A-Z')">A-Z</span><span :class="{order:order_type=='Z-A'}" @click="change_order_type('Z-A')">Z-A</span>-->
								<!--</p>-->
							</div>
						</th>
						<th class="relic_material" @mouseenter="show_filter_condition('relic_material')" @mouseleave="hide_filter_condition('relic_material')" width="10%">
							<span>材质<i class="arrow_down"></i></span>
							<div class="material_filter_condition left" @mouseleave="hide_filter_condition('relic_material')" v-show="status.relic_material">
								<!-- 模拟材质列表 -->
								<!--<ul class="_header">-->
								<!--<li @click="sel_material_first_word('全部')" :class="{active:material_first_word=='全部'}" class="all_material">全部</li>-->
								<!--<li v-for="data in material_first_word_list" @click="sel_material_first_word(data)" :class="{active:material_first_word==data}" class="_first_word">-->
								<!--{{data}}-->
								<!--</li>-->
								<!--</ul>-->
								<ul class="_body">
									<li v-for="data in material_list" @click="change_filter(data.name,'material')" class="filtered_relic_item" v-show='data.name' :class="{active:filter_list.material.indexOf(data.name)!=-1}">
										{{data.name}}
									</li>
								</ul>
							</div>
						</th>
						<th class="relic_category" width="10%" @mouseenter="show_filter_condition('relic_category')" @mouseleave="hide_filter_condition('relic_category')">
							<span>类别<i class="arrow_down"></i></span>
							<div class="category_filter_condition right" @mouseleave="hide_filter_condition('relic_category')" v-show="status.relic_category">
								<!-- 模拟类别列表 -->
								<!--<ul class="_header">-->
								<!--<li @click="sel_category_first_word('全部')" :class="{active:category_first_word=='全部'}" class="all_material">全部</li>-->
								<!--<li v-for="data in category_first_word_list" @click="sel_category_first_word(data)" :class="{active:category_first_word==data}" class="_first_word">-->
								<!--{{data}}-->
								<!--</li>-->
								<!--</ul>-->
								<ul class="_body">
									<li v-for="data in category_list" @click="change_filter(data.name,'category')" class="filtered_relic_item" v-show='data.name' :class="{active:filter_list.category.indexOf(data.name)!=-1}">
										{{data.name}}
									</li>
								</ul>
							</div>
						</th>
						<th class="relic_age" width="10%" @mouseenter="show_filter_condition('relic_age')" @mouseleave="hide_filter_condition('relic_age')">
							<span>年代<i class="arrow_down"></i></span>
							<div class="age_filter_condition right" @mouseleave="hide_filter_condition('relic_age')" v-show="status.relic_age">
								<!-- 模拟年代列表 -->
								<!--<ul class="_header">-->
								<!--<li @click="sel_age_first_word('全部')" :class="{active:age_first_word=='全部'}" class="all_material">全部</li>-->
								<!--<li v-for="data in age_first_word_list" @click="sel_age_first_word(data)" :class="{active:age_first_word==data}" class="_first_word">-->
								<!--{{data}}-->
								<!--</li>-->
								<!--</ul>-->
								<ul class="_body">
									<li v-for="data in age_list" @click="change_filter(data.name,'age')" class="filtered_relic_item" v-show='data.name' :class="{active:filter_list.age.indexOf(data.name)!=-1}">
										{{data.name}}
									</li>
								</ul>
							</div>
						</th>
						<th class="relic_nav" width="30%" @mouseenter="show_filter_condition('relic_nav')" @mouseleave="hide_filter_condition('relic_nav')">
							<span>位置<i class="arrow_down" v-show="env_name.length!=0"></i></span>
							<div class="nav_filter_condition left right" @mouseleave="hide_filter_condition('relic_nav')" v-show="status.relic_nav&&env_name.length!=0">
								<ul>
									<li v-for="nav in env_name" track-by="$index" @click="change_filter(nav,'position')" :class="{active:filter_list.position.indexOf(nav)!=-1}">
										{{nav}}
									</li>
								</ul>
							</div>
						</th>
					</tr>
					</thead>
					<tbody>
					<!--<tr v-for="(index,data) in filtered_relic_name">-->
					<tr v-for="(index,data) in relic_rows">
						<td class="relic_status">
							<!--:class="{no_need_repair:data.status=='不需修复'||data.status=='无需修复',need_repair:data.status=='需要修复',need_repair_asap:data.status=='亟需修复'||data.status=='亟待修复',in:data.status=='展出'||data.status=='修复中'||data.status=='修复'||data.status=='研究中'||data.status=='研究'||data.status=='已归还',out:data.status=='借出'||data.status=='借入'}"-->
							<span class="relic_status_item" :class="data.status">{{data.status||'无状态信息'}}</span>
						</td>
						<td class="relic_name_no">
							<p style="cursor: pointer;padding-left: 30px" @click="go_relic_detail(data.relic_no)">
								<img v-if="data.image" :src="data.image" :alt="" @mouseenter.stop="show_big_img($event,data.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{data.name}}</span><span class="relic_no">{{data.relic_no}}</span>
							</p>
						</td>
						<td class="relic_material">
							{{data.material}}
						</td>
						<td class="relic_category">
							{{data.category}}
						</td>
						<td class="relic_age">
							{{data.age}}
						</td>
						<td class="relic_nav">
							<p><span v-if="data.map&&data.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,data.map,data.locate,data)" @mouseleave="hide_big_nav"></span>{{nav_info(data.nav)||'暂无位置信息'}}</p>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
		<page-list :page.sync="curr_page" :allpage="page_num" :count="total"></page-list>
	</div>
</template>


<template id="environment_map">
		<div id="map">
			<div class="map_top">
				<div class="title_label lf">筛选条件 : </div>
				<select v-show="curr_env_no" name="env_name" id="env_name" v-model="curr_env_no" @change="change_map(curr_env_no)">
					<option :value="index" v-for="(index,data) in env_list">{{data.name}}</option>
				</select>
				<div class="title_label lf" v-show="!curr_env_no">请从左侧环境树中选择环境!</div>
			</div>
			<div class="bgContainer">
				<span class="resetBtn" @click="resetImg"></span>
				<div class="imgView" @mousewheel="scaleImg" @mousedown="dragStart" style="box-sizing: border-box;">
					<div class="imgBox" :style="imgStyle" id="imgBox" >
						<img :src="imgUrl" style="width:100%" v-show="imgUrl" alt="图片无法正常加载...">
						<div id="mapPoint" v-show="mapPointData&&mapPointData.locate" :style="pointStyle" :data-title="tooltip"></div>
					</div>
				</div>
			</div>
			<!--<div class="map_container" id="map_bg">-->
				<!--<div id="map_point" v-show="curr_locate" :data-title="tooltip"></div>-->
			<!--</div>-->
		</div>
</template>




	<!--综合筛选组件-->
	<!--公共筛选条件组件-->
<!--使用方法-->
<!--<div class="filterWrap">-->
    <!--<filter-component type="传入设备类型关键字" hide-type="in/out"></filter-component>-->
<!--</div>-->
<!--隐藏部分状态菜单-->
<!--hide-type="in/out" in:入库,out:出库-->
<!--设备类型关键字:-->
<!--环境报警:env_alert-->
<!--藏品管理:relic_manage(藏品出库,藏品入库)-->
<!--设备管理:equip_manage-->
<!--设备报警:equip_alert-->
<!--盘点详情:plan_detail-->

<style>
    .filterWrap{
        min-width:200px;
        height:50px;
        float:left;
        /*border:1px solid blue;*/
        box-sizing: border-box !important;
    }
    .componentContainer{
        width:360px;
        box-sizing: border-box !important;
        line-height: 28px;
        height:28px;
        position:relative;
        top:11px;
        /*border:1px solid red;*/
    }
    .componentContainer .inputWrap ._input::-webkit-input-placeholder { /* WebKit browsers */
        color:#c0c3c9;
    }
    .componentContainer .inputWrap ._input:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
        color:#c0c3c9;
    }
    .componentContainer .inputWrap ._input::-moz-placeholder { /* Mozilla Firefox 19+ */
        color:#c0c3c9;
    }
    .componentContainer .inputWrap ._input:-ms-input-placeholder { /* Internet Explorer 10+ */
        color:#c0c3c9;
    }
    .componentContainer .inputWrap{
        font-size:12px;
        width:260px;
        color:#5b6272;
        position: relative;
    }
    .componentContainer .inputWrap .handleWrap{
        width:75px;
        position:absolute;
        top:0;
        right:0;
        bottom:0;
    }
    .componentContainer ._icon{
        box-sizing: border-box !important;
        display: inline-block;
        width:26px;
        height:26px;
        background:url(../common/images/filterIcon.png) no-repeat;
        /*position: relative;*/
        /*top:1px;*/
        /*right:1px;*/
        cursor:pointer;
        vertical-align: middle;
        margin-top: -1px;
    }
    .componentContainer .inputWrap .handleWrap .searchIcon{
        /*border:1px solid red;*/
        background-position: 0 0;
    }
    .componentContainer .inputWrap .handleWrap .searchIcon:hover,.componentContainer .inputWrap .handleWrap .searchIcon.hover{
        background-position:-26px 0;
    }
    .componentContainer .inputWrap .deleteIcon{
        /*position: absolute;*/
        /*left:0;*/
        /*top:0;*/
        background-position: -52px 0;
    }
    .componentContainer .inputWrap ._input{
        width:100%;
        border:1px solid #d7d7d7;
        box-sizing: border-box !important;
        height:28px;
        border-radius:3px;
        /*position: relative;*/
        /*top:-1px;*/
        outline: none;
        vertical-align: top;
        padding:0 75px 0 10px;
    }
    .componentContainer .inputWrap .filterBtn{
        box-sizing: border-box !important;
        height:18px;
        line-height: 18px;
        font-size:14px;
        color:#1bbc9b;
        position: absolute;
        left:28px;
        top:5px;
        /*border:1px solid red;*/
        border-left:1px solid #5b6272;
        padding:0 5px;
    }
    .componentContainer .resetWrap{
        font-size: 14px;
        position: absolute;
        right:0;
        top:0;
        bottom:0;
        color:#5b6272;

    }
    .componentContainer .overlay{
        position: absolute;
        top:35px;
        left:0;
        background-color:#fff;
        z-index:99999;
        border-radius:3px;
        box-shadow: -1px 1px 3px 1px #ccc;
        font-size: 12px;
        color:#666;
    }

    .componentContainer .searchSuggest{
        right:0;
        overflow: hidden;
    }
    .componentContainer .searchSuggest .listWrap{
        /*border:1px solid red;*/
        /*max-height:160px;*/
        margin:0 auto;
        overflow: auto;
    }
    .componentContainer .searchSuggest .listWrap ul li{
        cursor:pointer;
        padding-left:10px !important;
        color:#5b6272;
    }
    .componentContainer .searchSuggest .listWrap ul li:hover{
        background-color:#1bbc9b;
        color:#fff;
    }

    .componentContainer .searchSuggest footer i{
        font-style:normal;
    }
    .componentContainer .searchSuggest footer p{
        height:26px;
        text-align: center;
        line-height: 24px;
        /*width:80px;*/
        /*margin: 0 auto;*/
        cursor:pointer;
        position: relative;
    }
    .componentContainer .searchSuggest footer p:hover{
        text-decoration: underline;
    }
    .componentContainer .ivu-icon{
        cursor:pointer;
    }
    /* always present */
    .expand-transition {
        transition: all .25s ease;
        /*padding: 10px;*/
        padding:10px 0 10px 0;
    }
    /* .expand-enter defines the starting state for entering */
    /* .expand-leave defines the ending state for leaving */
    .expand-enter, .expand-leave {
        height: 0;
        padding: 0 10px;
        opacity: 0;
    }

    .componentContainer .filterPanel{
        width:840px;
        height:470px;
        overflow: auto;
        /*border:1px solid red;*/
    }
    .componentContainer .filterPanel>header{
        border-bottom:1px solid #d9dde0;
    }
    .componentContainer .filterPanel section .side{
        position: absolute;
        top:10px;
        bottom:10px;
        /*border:1px solid green;*/
    }
    .componentContainer .filterPanel section aside.leftPanel{
        left:10px;
        right:80%;
        overflow: hidden;
    }
    .componentContainer .filterPanel section aside.leftPanel header{
        font-weight:bold;
        line-height: 40px;
    }
    /*环境树样式覆盖*/
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer{
        position: absolute;
        left:0;
        right:0;
        top:40px;
        bottom:0;
        overflow: auto;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-icon{
        color:#1bbc9b;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-tree-node-selected{
        color:#fff;
        background-color:#1bbc9b;
        border-color: #1bbc9b;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-tree li span.ivu-tree-switcher.ivu-tree-switcher-noop {
        display: inline-block !important;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-checkbox-checked .ivu-checkbox-inner{
        border-color: #1bbc9b;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-checkbox-checked:hover .ivu-checkbox-inner{
        border-color: #1bbc9b;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-checkbox-checked .ivu-checkbox-inner{
        background-color:#1bbc9b;
    }
    .componentContainer .filterPanel section aside.leftPanel .envTreeContainer .ivu-checkbox-indeterminate .ivu-checkbox-inner {
        background-color: #1bbc9b;
        border-color: #1bbc9b;
    }
    .componentContainer .filterPanel section div.rightPanel{
        right:10px;
        left:20%;
        overflow: auto;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList{
        position: absolute;
        /*border:1px solid #ddd;*/
        top:0;
        left:0;
        right:0;
        bottom:30px;
        overflow-y: scroll;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table{
        width:100%;
        border-collapse: collapse;
        position: relative;
        /*top:30px;*/
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table tr{
        /*height:40px;*/
        line-height: 40px;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table th{
        width:15%;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table th{
        white-space: nowrap;
        vertical-align: top;
    }

    .componentContainer .filterPanel section div.rightPanel .conditionList table th,
    .componentContainer .filterPanel section div.rightPanel .conditionList table td{
        /*border:1px solid red;*/
        font-size: 12px;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td .ivu-select-dropdown{
        z-index:30000;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td .timeWarp{
        box-sizing: border-box !important;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td .timeWarp *{
        box-sizing: border-box !important;
    }

    .componentContainer .filterPanel section div.rightPanel .conditionList table td.flexTd{
        display: flex;
        flex-direction: row;
        flex-wrap:wrap;
        justify-content: flex-start;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td.flexTd.bottomBorder{
        border-bottom: 1px solid #ddd;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td>span{
        line-height: 30px;
        padding:0 10px;
        border-radius:5px;
        margin:5px 10px 5px 0;
        cursor:pointer;
        white-space: nowrap;
    }
    .componentContainer .filterPanel section div.rightPanel .conditionList table td>span:hover,
    .componentContainer .filterPanel section div.rightPanel .conditionList table td>span.sel{
        background-color:#1bbc9b;
        color:#fff;
    }
    .componentContainer .filterPanel section div.rightPanel footer{
        position: absolute;
        /*border:1px solid #ddd;*/
        height:30px;
        left:0;
        right:0;
        bottom:0;
        text-align: right;
    }
    .componentContainer .filterPanel section div.rightPanel footer a{
        display: inline-block;
        width:55px;
        height:24px;
        text-align: center;
        line-height: 24px;
        font-size: 14px;
        background-color:#c0c1c5;
        color:#fff;
        margin-right:10px;
        border-radius:5px;
    }
    .componentContainer .filterPanel section div.rightPanel footer a:hover{
        background-color:#1bbc9b;
        text-decoration: none;
    }
    .componentContainer .filterPanel section div.rightPanel table td .fastSelect{
        text-align: center;
    }
    .componentContainer .filterPanel section div.rightPanel table td .fastSelect a{
        padding:3px 10px;
        /*border:1px solid red;*/
    }
</style>
<template id="filterComponent">
    <!--筛选组件-->
    <div class="componentContainer">
        <div class="inputWrap">
            <!---->
            <!--resetOption-->
            <input type="text" v-model="keyword" :placeholder="placeholder" class="_input" @focus="showSuggest" @keyup.esc="escHandler" @keypress.enter="searchKeyword" @click.stop>
            <div class="handleWrap">
                <span :class="['_icon','searchIcon',{hover:focusOn}]" @click="searchKeyword"></span>
                <a href="javascript:void(0)" class="filterBtn" @click.stop="togglePanel"> 筛选 </a>
            </div>
            <!--查询建议浮层-->
            <div class="overlay searchSuggest" v-show="suggestShow">
                <div class="listWrap">
                    <ul>
                        <li v-for="n in searchSuggest" track-by="$index" @click="selSuggestItem(n)">
                            {{n}}
                        </li>
                    </ul>
                </div>
                <footer>
                    <p @click.stop="cleanHistory" >
                        <span class="_icon deleteIcon"></span>
                        清空历史
                    </p>
                </footer>
            </div>
        </div>
        <div class="resetWrap">
            <span> {{filterItemCount}}项筛选 </span>
            <a href="javascript:void(0)" @click="resetOption" style="color:#a0a3ab;"> 清空 </a>
        </div>
        <div class="overlay filterPanel" v-show="panelShow" transition="expand" @click.stop>
            <!--<header>-->
                <!--已选条件-->
            <!--</header>-->
            <section>
                <aside class="side leftPanel">
                    <header>环境树</header>
                    <div class="envTreeContainer" id="environmentTree">
                        <Tree :data="treeData"
                              multiple
                              show-checkbox
                              @on-check-change="checkedNodes"
                              @on-select-change="selectNodes"
                        ></Tree>
                    </div>
                </aside>
                <div class="side rightPanel">
                    <div class="conditionList">
                        <table>
                            <tbody>

                            <!--设备管理筛选-->
                            <tr v-if="type==='equip_manage'">
                                <th>
                                    状态
                                </th>
                                <td class="flexTd">
                                    <span v-for="status in equip_manage_status" :class="{sel:filterObj.equip_manage_status.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_status',status.name)">{{status.name}} {{status.count}}</span>
                                </td>
                            </tr>
                            <tr v-if="type==='equip_manage'">
                                <th rowspan="5">
                                    类型
                                </th>
                                <td :class="['flexTd',{bottomBorder:monitor_terminal&&monitor_terminal.length!==0}] ">
                                    <span v-if="monitor_terminal&&monitor_terminal.length!==0" :class="{sel:equip_type_sel_all.indexOf('monitor_terminal')!==-1}" @click="addAllToFilter('equip_manage_type','monitor_terminal')">所有监测终端{{count('monitor_terminal')}}</span>
                                    <span v-for="status in monitor_terminal" :class="{sel:filterObj.equip_manage_type.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_type',status.name,'monitor_terminal')">{{status.name}} {{status.count}}</span>
                                </td>
                                <td :class="['flexTd',{bottomBorder:control_equipment&&control_equipment.length!==0}] ">
                                    <span v-if="control_equipment&&control_equipment.length!==0" :class="{sel:equip_type_sel_all.indexOf('control_equipment')!==-1}" @click="addAllToFilter('equip_manage_type','control_equipment')">所有调控设备{{count('control_equipment')}}</span>
                                    <span v-for="status in control_equipment" :class="{sel:filterObj.equip_manage_type.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_type',status.name,'control_equipment')">{{status.name}} {{status.count}}</span>
                                </td>
                                <td :class="['flexTd',{bottomBorder:network_equipment&&network_equipment.length!==0}] ">
                                    <span v-if="network_equipment&&network_equipment.length!==0" :class="{sel:equip_type_sel_all.indexOf('network_equipment')!==-1}" @click="addAllToFilter('equip_manage_type','network_equipment')">所有网络设备{{count('network_equipment')}}</span>
                                    <span v-for="status in network_equipment" :class="{sel:filterObj.equip_manage_type.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_type',status.name,'network_equipment')">{{status.name}} {{status.count}}</span>
                                </td>
                                <td :class="['flexTd',{bottomBorder:offline_equipment&&offline_equipment.length!==0}] ">
                                    <span v-if="offline_equipment&&offline_equipment.length!==0" :class="{sel:equip_type_sel_all.indexOf('offline_equipment')!==-1}" @click="addAllToFilter('equip_manage_type','offline_equipment')">所有手持式设备{{count('offline_equipment')}}</span>
                                    <span v-for="status in offline_equipment" :class="{sel:filterObj.equip_manage_type.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_type',status.name,'offline_equipment')">{{status.name}} {{status.count}}</span>
                                </td>
                                <td class="flexTd">
                                    <span v-if="other_equipment&&other_equipment.length!==0" :class="{sel:equip_type_sel_all.indexOf('other_equipment')!==-1}" @click="addAllToFilter('equip_manage_type','other_equipment')">所有其它设备{{count('other_equipment')}}</span>
                                    <span v-for="status in other_equipment" :class="{sel:filterObj.equip_manage_type.indexOf(status.name)!==-1}" @click="changeFilter('equip_manage_type',status.name,'other_equipment')">{{status.name}} {{status.count}}</span>
                                </td>
                            </tr>

                            <!--设备报警筛选-->
                            <tr v-if="type==='equip_alert'" v-show="equip_alert_type&&equip_alert_type.length!==0">
                                <th>
                                    报警类型
                                </th>
                                <td class="flexTd">
                                    <span v-for="type in equip_alert_type" :class="{sel:filterObj.equip_alert_type.indexOf(type.name)!==-1}" @click="changeFilter('equip_alert_type',type.name)">{{type.name}} {{type.count}}</span>
                                </td>
                            </tr>

                            <!--环境报警筛选-->
                            <tr v-if="type==='env_alert'">
                                <th>
                                    报警参数
                                </th>
                                <td class="flexTd">
                                    <span v-for="param in env_alert_param" :class="{sel:filterObj.env_alert_param.indexOf(param.name)!==-1}" @click="changeFilter('env_alert_param',param.name)">{{dictionary[param.name]}} {{param.count}}</span>
                                </td>
                            </tr>

                            <!--文物管理筛选-->
                            <tr v-if="type==='relic_manage'" v-show="hideType==='plan_detail'">
                                <th>盘点状态</th>
                                <td class="flexTd">
                                    <template v-for="check in relic_check_status" >
                                        <span v-if="check.name"  v-show="hideType" :class="{sel:filterObj.relic_check_status.indexOf(check.name)!==-1}" @click="changeFilter('relic_check_status',check.name)">{{check.name}} {{check.count}}</span>
                                    </template>
                                </td>
                            </tr>

                            <tr v-if="type==='relic_manage'" v-show="hideType!=='plan_detail'">
                                <th>状态</th>
                                <td class="flexTd">
                                    <template v-for="status in relic_status" >
                                        <span v-if="status.name"  v-show="!hideType||(hideType==='in'&&status.name!=='亟需修复'&&status.name!=='不需修复'&&status.name!=='需要修复')||(hideType==='out'&&(status.name==='亟需修复'||status.name==='不需修复'||status.name==='需要修复'))" :class="{sel:filterObj.relic_status.indexOf(status.name)!==-1}" @click="changeFilter('relic_status',status.name)">{{status.name}} {{status.count}}</span>
                                    </template>
                                </td>
                            </tr>
                            <tr v-if="type==='relic_manage'">
                                <th>等级</th>
                                <td class="flexTd">
                                    <template v-for="level in relic_level">
                                        <span  v-if="level.name&&level.count" :class="{sel:filterObj.relic_level.indexOf(level.name)!==-1}" @click="changeFilter('relic_level',level.name)">{{level.name}} {{level.count}}</span>
                                    </template>
                                </td>
                            </tr>
                            <tr v-if="type==='relic_manage'">
                                <th>材质</th>
                                <td class="flexTd">
                                    <template v-for="material in relic_material">
                                        <span  v-if="material.name&&material.count" :class="{sel:filterObj.relic_material.indexOf(material.name)!==-1}" @click="changeFilter('relic_material',material.name)">{{material.name}} {{material.count}}</span>
                                    </template>
                                </td>
                            </tr>
                            <tr v-if="type==='relic_manage'" v-show="hideType!=='plan_detail'">
                                <th>类型</th>
                                <td class="flexTd">
                                    <template v-for="category in relic_category">
                                        <span  v-if="category.name&&category.count" :class="{sel:filterObj.relic_category.indexOf(category.name)!==-1}" @click="changeFilter('relic_category',category.name)">{{category.name}} {{category.count}}</span>
                                    </template>
                                </td>
                            </tr>
                            <tr v-if="type==='relic_manage'" v-show="hideType!=='plan_detail'">
                                <th>年代</th>
                                <td class="flexTd">
                                    <template v-for="age in relic_age">
                                        <span  v-if="age.name&&age.count" :class="{sel:filterObj.relic_age.indexOf(age.name)!==-1}" @click="changeFilter('relic_age',age.name)">{{age.name}} {{age.count}}</span>
                                    </template>
                                </td>
                            </tr>


                            <!--共用时间筛选-->
                            <tr v-if="type==='equip_alert'||type==='env_alert'">
                                <th>
                                    报警时间
                                </th>
                                <td>
                                    <div class="timeWarp">
                                        <!--style="width: 200px"-->
                                        <Row>
                                            <i-col span="14">
                                                <Date-picker
                                                        type="datetimerange"
                                                        format="yyyy-MM-dd HH:mm"
                                                        :value="timeArr"
                                                        placeholder="选择日期和时间"
                                                        :clearable="true"
                                                        :options="timePickerOption"
                                                        @on-change="changeTime"
                                                        placement="bottom-start"
                                                        :editable="false"
                                                        @on-ok="requireData"
                                                        @on-clear="resetTime"
                                                        @on-open-change="saveOldTime">
                                                </Date-picker>
                                            </i-col>
                                        </Row>
                                    </div>
                                </td>
                            </tr>

                            </tbody>
                        </table>
                    </div>
                    <footer>
                        <a href="javascript:void(0)" @click="okHandler">确定</a>
                        <a href="javascript:void(0)" @click="cancelHandler">取消</a>
                    </footer>
                </div>
            </section>
        </div>
    </div>
</template>
<script type="text/javascript">
    //参数名称字典
    var dictionary={
        temperature:'温度',
        humidity:'相对湿度',
        light:'光照强度',
        uv:'紫外强度',
        co2:'二氧化碳浓度',
        voc:'voc',
        organic:'有机物挥发物浓度',
        inorganic:'无机物',
        sulfur:'含硫',
        box_open_alert:'非法开盖',
        move_alert:'智能囊匣异常震动',
        broken:'玻璃破碎',
        vibration:'安防监测终端异常震动',
        multi_wave:'多维驻波'
    };
    
    //生成环境树方法
    var makeTree = function (nodes,expand_key) {
        //拷贝原数组
        var treeListCopy = JSON.parse(JSON.stringify(nodes)),
            result = [];
        //遍历树结构
        if (treeListCopy && treeListCopy.length !== 0) {
            // console.log(treeListCopy)
            treeListCopy.forEach(function (node, index) {
                // console.log(node);
                //默认环境树全部展开
                var nodeObj = {
                    title: '',
                    children: [],
                    env_no: '',
                    expand: false
                };
                if(node.type==='楼栋' || node.type==='楼层'){
                    nodeObj.expand = true;
                }
                nodeObj.title = node.name;
                nodeObj.env_no = node.env_no;
                if (node.children && node.children.length !== 0) {
                    nodeObj.children = makeTree(node.children);
                }
                result.push(nodeObj);
                nodeObj = null;
                
            })
        }
        
        return result;
    };

    //获取环境树选中节点的方法
    var getSelectNodes = function(nodes,result){
        if(!result){
            result = [];
        }
        if(nodes && nodes.length!==0){
            nodes.forEach(function(node,index){
                if(node.checked){
                    if(node.childrenCheckedStatus===2){
                        if(result.indexOf(node.env_no)===-1){
                            result.push(node.env_no);
                        }
                        if(node.children && node.children.length!==0){
                            getSelectNodes(node.children,result);
                        }
                    }else if(node.childrenCheckedStatus===1){
                        if(node.children && node.children.length!==0){
                            getSelectNodes(node.children,result);
                        }
                    }
                }
            });
        }
        return result;
    };

    //转换时间戳
    var timeStamp = function(time){
        if(time){
            return Date.parse(time);
        }
    };
    //计算时间
    var calcTime = function(time,type){
        var year = time.getFullYear(),
            month = time.getMonth()+1,
            day = time.getDate(),
            weekday = time.getDay(),
            newDate = time;
        if(type==='today'){
            newDate.setHours(0,0,0);
        }
        else if(type==='yesterday'){
            newDate.setDate(day-1);
            newDate.setHours(0,0,0);
        }
        else if(type==='week'){
            newDate.setDate(day-weekday+1);
            newDate.setHours(0,0,0);
        }else if(type==='month'){
            newDate.setDate(1);
            newDate.setHours(0,0,0);
        }
        return newDate;
    };
    var defaultFilterObj = {
        //选择筛选设备的报警类型
        equip_alert_type:[],
        //筛选时间
        time:[],
        //环境树节点
        nodes:[],
        //选择筛选设备的状态类型
        equip_manage_status:[],
        //选择筛选设备的类型
        equip_manage_type:[],
        //选择筛选环境的报警类型
        env_alert_param:[],
        //选择文物状态筛选
        relic_status:[],
        //选择文物等级筛选
        relic_level:[],
        //选择文物材质筛选
        relic_material:[],
        //选择文物类型筛选
        relic_category:[],
        //选择文物年代筛选
        relic_age:[],
        //选择文物盘点状态筛选
        relic_check_status:[]
    };
    Vue.component('filter-component',{
        template:'#filterComponent',
        props:['type','hideType','taskId'],
        data:function(){
            return {
                placeholder:'请输入ID或名称查询',
                filterObj:JSON.parse(JSON.stringify(defaultFilterObj)),

                //参数字典
                dictionary:dictionary,

                //拷贝筛选对象,用于条件还原
                filterObjCopy:null,
                treeDataCopy:null,
                timeArrCopy:null,
                equip_type_sel_all_copy:null,
                keyword_copy:null,
                //某种类型设备全选的标记
                equip_type_sel_all:[],
                equip_alert_type:[],
                equip_manage_status:[],

                monitor_terminal:[],
                control_equipment:[],
                network_equipment:[],
                offline_equipment:[],
                other_equipment:[],

                //文物模块
                //状态
                relic_status:[],
                //年代
                relic_age:[],
                //类别
                relic_category:[],
                //位置通过环境树选择
//                relic_hall:[],
                //材质
                relic_material:[],
                //等级
                relic_level:[],
                //盘点状态
                relic_check_status:[], 

                //环境预警参数条件
                env_alert_param:[],
                //筛选条件是否展开
                panelShow:false,
                //查询建议
                suggestShow:false,
                //输入框状态
                focusOn:false,
                //搜索关键字
                keyword:'',
                //搜索建议(最大长度限制为7项)
                searchSuggest:[],
                treeData:[],
                defaultTreeData:[],
                timeArr:[],						//显示的时间,默认显示
                timeOldArr:[],
                timeChangeArr:[],
                timeSure:false,//时间标志位,标志是点击确定请求数据还是遮罩层消失
                timePickerOption:{
                    shortcuts:[
                        {
                            text:'今天',
                            value:function () {
                                var start,end;
                                // shortTime=true;
                                end = new Date().setHours(23,59,59);
                                start = calcTime(new Date(),'today');//计算今天00:00起始时间
                                return [start,end];
                            }
                        },
                        {
                            text:'昨天',
                            value:function () {
                                var start,end;
                                shortTime=true;
                                end = new Date().setHours(0,0,0)-1000;
                                start = calcTime(new Date(),'yesterday');//计算24小时起始时间
                                return [start,end];
                            }
                        },
                        {
                            text:'本周',
                            value:function () {
                                var start,end;
                                // shortTime=true;
                                end = new Date().setHours(23,59,59);
                                start = calcTime(new Date(),'week');//计算3天前00:00起始时间
                                return [start,end];
                            }
                        },
                        {
                            text:'本月',
                            value:function () {
                                var start,end;
                                // shortTime=true;
                                end = new Date().setHours(23,59,59);
                                start = calcTime(new Date(),'month');//计算7天前00:00起始时间
                                return [start,end];
                            }
                        }
                    ],
                    disabledDate:function(date){//当前时间之后的时间禁用
                        return date && date.valueOf() > Date.now();
                    }
                },
            }
        },
        created:function(){
            var me = this;

            //准备阶段,请求环境树数据,inc_self,自己节点包括父节点本身
            $.get('/2.2.05_P001/base_api/base/envs/tree/',{inc_self:1}, function (data) {
                if(data.error){
                    me.$Message.error(data.error);
                    return;
                }
                me.treeData = makeTree(data);
                me.defaultTreeData = JSON.parse(JSON.stringify(me.treeData));
            });
            if(this.type==='env_alert'){
                this.placeholder='报警环境名称、关联文物名称';
                $.get('/2.2.05_P001/base_api/env/monitor/alerts/alert_count',{clear:1},function(res){
//                    console.log(res);
                    if(res.alert_time&&res.alert_time.length!==0){

                    }
                    if(res.param&&res.param.length!==0){
                        me.env_alert_param= res.param;
                    }
                });
            }else if(this.type==='equip_manage'){
                this.placeholder='设备名称、设备ID';
                //获取设备类别
                $.get('/2.2.05_P001/base_api/env/equipments/count/type_count',function(res){
//                    console.log(res);
                    if(res.监测终端){
                        me.monitor_terminal = res.监测终端;
                    }
                    if(res.调控设备){
                        me.control_equipment = res.调控设备;
                    }
                    if(res.网络设备){
                        me.network_equipment = res.网络设备;
                    }
                    if(res.手持式){
                        me.offline_equipment = res.手持式;
                    }
                    if(res.其它){
                        me.other_equipment = res.其它;
                    }
                });
                //获取设备状态
                $.get('/2.2.05_P001/base_api/env/equipments/count/status_count',function(res){
//                    console.log(res);
                    me.equip_manage_status = res;
                });
            }else if(this.type==='relic_manage'){
                var options = {};
                if(this.hideType==='in'||this.hideType==='out'){
                    options.opt = this.hideType;
                }
                if(this.hideType!=='plan_detail'){
                    this.placeholder='藏品名称、总登记号';
                    //获取筛选条件列表
                    $.get('/2.2.05_P001/base_api/relic/relics/count/filter_conditions',options,function(res){
                        if(res.category){
                            me.relic_category = res.category;
                        }
                        if(res.age){
                            me.relic_age = res.age;
                        }
                        if(res.material){
                            me.relic_material = res.material;
                        }
                        if(res.level){
                            me.relic_level = res.level;
                        }
                        if(res.status){
                            me.relic_status = res.status;
                        }
                    });
                }else {
                    this.placeholder='标签号、藏品名称、总登记号';
                    setTimeout(function(){

                    },0);
                }
            }else if(this.type==='equip_alert'){
//                console.log('设备报警');
                this.placeholder='设备名称、设备ID';
                $.get('/2.2.05_P001/base_api/env/equipments/alerts/alert_count',function(res){
//                    console.log(res);
                    if(res.param&&res.param.length!==0){
                        me.equip_alert_type = res.param;
                    }
                });
            }
        },
        watch:{
            taskId:function(val){
                var options = {},
                    me = this;
                if(val){
                    options.taskId = val;
                }
                $.get('/2.2.05_P001/base_api/relics/inventoryDetail/getConditions'+'?requestType=pc',options,function(res){
                    if(res.error_code===0&&res.message==='操作成功'){
                        if(res.data){
//                                console.log(res.data);
                            if(res.data.material){
                                me.relic_material = res.data.material;
                            }
                            if(res.data.level){
                                me.relic_level = res.data.level;
                            }
                            if(res.data.result){
                                me.relic_check_status = res.data.result;
                            }
                        }
                    }else{
                        me.$Message.error(res.message);
                    }
                })
                    .error(function(res){
                        console.error(res);
                    })
            }
        },
        ready:function(){
            var me = this;
            $('#environmentTree').delegate('.ivu-checkbox-wrapper','click',function(){
//                console.log(me.treeData);
                //根据treeData,获取选中的节点数据
                me.filterObj.nodes = getSelectNodes(me.treeData);
            });
        },
        computed:{
            //筛选条件总数统计
            filterItemCount:function(){
                var count = 0;
                if(this.type==='equip_alert'){
                    if(this.filterObj){
                        for(var key in this.filterObj){
                            if(key==='keyword'){
                                continue;
                            }
                            //环境树节点不在此处纳入数量统计
                            if(key!=='time'){
                                if(this.filterObj[key]){
                                    count += this.filterObj[key].length;
                                }
                            }else if(key==='time'){
                                if(this.filterObj.time&&this.filterObj.time.length!==0){
                                    count ++;
                                }
                            }
                        }
                    }
                }else if(this.type==='equip_manage'){
                    if(this.filterObj){
                        for(var key in this.filterObj){
                            if(key==='keyword'){
                                continue;
                            }
                            if(this.filterObj[key]){
                                count += this.filterObj[key].length;
                            }
                        }
                    }
                }else if(this.type==='env_alert'){
                    if(this.filterObj){
                        for(var key in this.filterObj){
                            if(key==='keyword'){
                                continue;
                            }
                            if(this.filterObj[key]){
                                count += this.filterObj[key].length;
                            }
                        }
                    }
                }else if(this.type==='relic_manage'){
                    if(this.filterObj){
                        for(var key in this.filterObj){
                            if(key==='keyword'){
                                continue;
                            }
                            if(this.filterObj[key]){
                                count += this.filterObj[key].length;
                            }
                        }
                    }
                }
                return count;
            }
        },
        methods:{
            count:function(kind){
                var count = 0;
                if(this[kind]){
                    for(var key in this[kind]){
                        if(this[kind][key].count){
                            count += this[kind][key].count;
                        }
                    }
                }
                return count;
            },
            checkedNodes:function(checkedNodes){
//                console.log(checkedNodes);
//                var nodes = [];
//                if(checkedNodes&&checkedNodes.length!==0){
//                    checkedNodes.forEach(function(node,index){
//                        if(nodes.indexOf(node.env_no)===-1){
//                            nodes.push(node.env_no);
//                        }
//                    });
//                }
//                this.filterObj.nodes = nodes;
            },
            selectNodes:function(selectNodes){
//                console.log(selectNodes);
//                if(selectNodes&&selectNodes.length!==0){
//                    selectNodes.forEach(function(node,index){
//                        if(nodes.indexOf(node.env_no)===-1){
//                            nodes.push(node.env_no);
//                        }
//                    });
//                }
//                console.log(selectNodes,nodes);
//                this.filterObj.nodes = nodes;
            },
            //如果有全选联动,每选择一个条件,需要检查是否全选
            changeFilter:function(type,item,check_type){
//                console.log(type,item,check_type,this.filterObj);
                if(item){
                    var itemList = JSON.parse(JSON.stringify(this.filterObj[type]));
                    if(itemList){
                        var index = itemList.indexOf(item);
                        if(index===-1){
                            itemList.push(item);
                            //增加项目后,验证是否被全选
                            if(check_type){
                                if(this.checkAll(check_type,itemList)){
                                    if(this.equip_type_sel_all.indexOf(check_type)===-1){
                                        this.equip_type_sel_all.push(check_type);
                                    }
                                }
                            }
                        }else{
                            itemList.splice(index,1);
                            //减少项目后,如果该类型之前被全选,取消该类型的全选
                            if(check_type){
                                if(this.equip_type_sel_all.indexOf(check_type)!==-1){
                                    this.equip_type_sel_all.splice(this.equip_type_sel_all.indexOf(check_type));
                                }
                            }
                        }
                        this.filterObj[type] = itemList;
                    }
                }
            },
            checkAll:function(check_type,itemList){
//                console.log(check_type,itemList,this[check_type]);
                var check_result = true;
                if(this[check_type]){
//                    console.log('需要验证');
                    for(var key in this[check_type]){
                        if(itemList&&itemList.length!==0){
                            if(itemList.indexOf(this[check_type][key].name)===-1){
                                check_result = false;
                                break;
                            }
                        }
                    }
                }
                return check_result;
            },
            addAllToFilter:function(type,kind){
                var me = this;
                if(this.equip_type_sel_all.indexOf(kind)===-1){
                    this.equip_type_sel_all.push(kind);
                    if(!this.filterObj[type]){
                        this.filterObj[type] = [];
                    }
                    if(this[kind]){
                        for(var key in this[kind]){
                            if(this[kind][key]){
                                if(me.filterObj[type].indexOf(this[kind][key].name)===-1){
                                    me.filterObj[type].push(this[kind][key].name);
                                }
                            }
                        }
                    }
                }else{
                    this.equip_type_sel_all.splice(this.equip_type_sel_all.indexOf(kind),1);
                    if(this[kind]){
                        for(var key in this[kind]){
                            if(this[kind][key]){
                                if(me.filterObj[type].indexOf(this[kind][key].name)!==-1){
                                    me.filterObj[type].splice(me.filterObj[type].indexOf(this[kind][key].name));
                                }
                            }
                        }
                    }
                }
            },
            okHandler:function(){
//                console.log('向父组件发送消息,读取数据',this.filterObj);
                //父组件监听reload_data事件,重载数据
                this.$dispatch('reload_data',this.filterObj);
                this.panelShow = false;
            },
            cancelHandler:function(){
                this.panelShow = false;
                this.filterObj = this.filterObjCopy;
                this.treeData = this.treeDataCopy;
                this.timeArr = this.timeArrCopy;
                this.equip_type_sel_all = this.equip_type_sel_all_copy;
            },
            saveOldTime:function(open){
                if(open){
                    this.timeSure = false;
                    //拷贝一份原始的时间对象
                    this.timeOldArr = JSON.parse(JSON.stringify(this.timeArr));
                    this.timeChangeArr = JSON.parse(JSON.stringify(this.timeArr));
                }else{
                    if(!this.timeSure){
                        this.timeArr = this.timeOldArr;
                    }
                }
            },
            changeTime:function(val){
                var filterObj = JSON.parse(JSON.stringify(this.filterObj));
                //如果时间被清空,则直接返回,然后通过resetTime方法把时间数组复制为空数组
                if(!val){
                    filterObj.time = [];
                    this.filterObj = filterObj;
                    return;
                }
//                console.log('changeTime',val);
                this.timeArr = val.split(' - ').map(timeStamp);
                //是否需要将日期终点设置为23点59分59秒,需要添加一次判断,如果日期未发生变化,则只修改时间;
                var startDate1 = new Date(this.timeArr[0]),
                    startDate2 = new Date(this.timeChangeArr[0]),
                    endDate1 = new Date(this.timeArr[1]),
                    endDate2 = new Date(this.timeChangeArr[1]);
                if((startDate1.getFullYear()===startDate2.getFullYear()&&endDate1.getFullYear()===endDate2.getFullYear())&&(startDate1.getDate()===startDate2.getDate()&&endDate1.getDate()===endDate2.getDate())&&(startDate1.getMonth()===startDate2.getMonth()&&endDate1.getMonth()===endDate2.getMonth())){//如果同年同月同日

                }else{//并非同年同日
                    this.timeArr.$set(1,new Date(this.timeArr[1]).setHours(23,59));
                }
                filterObj.time = this.timeArr;
                this.filterObj = filterObj;
                this.timeChangeArr = this.timeArr;
            },
            requireData:function(){
                this.timeSure = true;
            },
            resetTime:function(){
                var me = this;
                this.$nextTick(function(){
                    me.timeArr = [];
                });
            },
            fastSelect:function(type){
                var start,end,timeObj;
                timeObj = calcTime(new Date(),type);
                start = timeObj.start;
                end = timeObj.end;
                this.startTime = start;
                this.endTime = end;
            },
            //esc按键处理
            escHandler:function(e){
//                console.log(e);
                var target = e.srcElement||e.target;
                target.blur();
                this.hideSuggest();
            },
            showSuggest:function(){
                this.focusOn = true;
                this.keyword_copy = this.keyword;
                if(!this.searchSuggest||this.searchSuggest.length===0){
                    return ;
                }
                this.suggestShow = true;
            },
            hideSuggest:function(){
                var me = this;
                //设置一个延时,当点击放大镜时,先执行searchKeyword
                setTimeout(function(){
                    me.focusOn = false;
                    // me.keyword = me.keyword_copy||'';
                    me.suggestShow = false;
                },150);
            },
            searchKeyword:function(e){
                var target = e.srcElement||e.target;
                target.blur();
                if(this.keyword.trim()){
                    //最上方显示最新的查找建议
                    var index = this.searchSuggest.indexOf(this.keyword);
                    if(index!==-1){
                        this.searchSuggest.splice(index,1);
                    }else{
                        //如果当前查询建议个数是7个,删除最早的一项
                        if(this.searchSuggest&&this.searchSuggest.length>=7){
                            this.searchSuggest.pop();
                        }
                    }
                    this.searchSuggest.unshift(this.keyword);
                    this.filterObj.keyword = this.keyword;
                }else{
                    this.filterObj.keyword = '';
                }
                this.keyword_copy = this.keyword;
                this.$dispatch('reload_data',this.filterObj);
            },
            togglePanel:function(){
                this.panelShow = !this.panelShow;
                if(this.panelShow){
                    //打开面板时,拷贝当前设置的对象
                    this.filterObjCopy = JSON.parse(JSON.stringify(this.filterObj));
                    this.treeDataCopy = JSON.parse(JSON.stringify(this.treeData));
                    this.timeArrCopy = JSON.parse(JSON.stringify(this.timeArr));
                    this.equip_type_sel_all_copy = JSON.parse(JSON.stringify(this.equip_type_sel_all));
                }
            },
            cleanHistory:function(){
                this.searchSuggest = [];
                this.focusOn = false;
                this.suggestShow = false;
            },
            selSuggestItem:function(item){
                this.keyword = item;
                this.filterObj.keyword = this.keyword;
                this.keyword_copy = this.keyword;
                var index = this.searchSuggest.indexOf(this.keyword);
                if(index!==-1){
                    this.searchSuggest.splice(index,1);
                }
                this.searchSuggest.unshift(this.keyword);
                this.$dispatch('reload_data',this.filterObj);
            },
            resetOption:function(){
//                console.log('重置条件');
                var me = this;
                var resetId='';
                setTimeout(function(){
                    me.filterObj = JSON.parse(JSON.stringify(defaultFilterObj));
                    me.treeData = JSON.parse(JSON.stringify(me.defaultTreeData));
                    me.timeArr = [];
                    me.equip_type_sel_all = [];
                    me.filterObj.keyword = me.keyword='';
                    console.log(me.keyword)
                    me.$dispatch('reload_data',me.filterObj,resetId);
                },0);

            }
        },
        events:{
            hideOverlay:function(){
                if(this.panelShow){
                    this.panelShow = false;
                    this.filterObj = this.filterObjCopy;
                    this.treeData = this.treeDataCopy;
                    this.timeArr = this.timeArrCopy;
                    this.equip_type_sel_all = this.equip_type_sel_all_copy;
                }
                if(this.focusOn){
                    this.focusOn = false;
                }

                // me.keyword = me.keyword_copy||'';
                if(this.suggestShow) {
                    this.suggestShow = false;
                }
            },
            //父组件切换是否隐藏已经处理了的环境报警
            toggle_env_alert:function(status){
                var me = this;
                $.get('/2.2.05_P001/base_api/env/monitor/alerts/alert_count',{clear:status},function(res){
//                    console.log(res);
                    if(res.alert_time&&res.alert_time.length!==0){

                    }
                    if(res.param&&res.param.length!==0){
                        me.env_alert_param= res.param;
                    }
                });
            },
            reset_filter_obj:function(){
                //切换盘点详情时,重置盘点详情的筛选情况
                this.filterObj = JSON.parse(JSON.stringify(defaultFilterObj));
            }
        }
    });
</script>



	<!-- 新综合筛选组件 -->
	
	<!-- 环境树形列表组件-->
	<style>
	.hideInput input{
		display: none !important;
	}
    ul.env_tree_list>li>div:first-child input.show{
        display: block;
    }
    ul.env_tree_list li.root{
        padding-bottom:20px;
    }
    ul.env_tree_list li{
        position:relative;
        line-height: 26px;
        cursor:pointer;
        border-top: 1px solid #fff;
    }
    ul.env_tree_list span{
        display: inline-block;
		width: 24px;
		height: 20px;
		background: url(./images/environment_icon.png) no-repeat 0 -14px;
		position: absolute;
	    top: 5px;
    }
    ul.env_tree_list span.arrow{
        background-position:8px -14px;
        transition: all 0.3s;
    }
    ul.env_tree_list span.arrow.open{
        transform: rotate(90deg);
    }
    ul.env_tree_list>li>div:first-child p{
        overflow:hidden;
        text-overflow:ellipsis;
        white-space:nowrap;
        padding-left: 60px;
    }
    ul.env_tree_list>li>div:first-child:hover input{
        display: inline-block;
        cursor:pointer;
    }
    ul.env_tree_list li input{
	    width: 18px;
	    height: 18px;
	    position: absolute;
	    left: 5px;
	    top: 1px;
    }
    div.content ul.env_tree_list div.tree_item p.find{
        color:#5a9e6d;
        font-weight: bold;
    }
    .env_tree_list .status_box{
		width: 24px;
		position: absolute;
		top: 0;
		left: 22px;
	    height: 21px;
    }
    
    
    div.楼栋{
	    background: #DEDEDE;    
	    font-size: 16px;
    }
    div.楼层{
        background: #E7E8EA;	
        font-size: 14px;
    }
    div.展厅{
    	background: #F0F0F0;	
	    font-size: 12px;
    }
    div.展柜{
	    background: #fff;
        font-size: 12px;
        border-bottom: 1px solid #e7e8ea;
    }
    
    div.楼层 .arrow{
    	background-position: 8px -33px !important;
    }
    div.展厅 .arrow{
    	background-position: 8px -52px !important;
    }
    div.checked{
	    background: #45c7ad;
    	color: #fff;
    }
    div.checked .arrow{
    	background-position-x: -11px !important;
    }
    .env_tree_list  .icon{
        width: 33px;
        height: 33px;
        display: inline-block;
        position: absolute;
        margin-left: 25px;
        top: 0px;
        /*margin-top: 10px;*/
        /* border-radius: 50%; */
        background: transparent url(../common/images/newTypeIcon.png) no-repeat;
        /* border: 1px solid red; */
    }

    .env_tree_list  .icon.sensor_temperature_humidity,
    .env_tree_list  .icon.温湿度监测终端{
        background-position: 0 -560px;
    }

    .env_tree_list  .icon.sensor_offline_temperature_humidity,
    .env_tree_list  .icon.手持式温湿度检测仪,
    .env_tree_list  .icon.固定式温湿度检测仪{
        background-position: 0 -665px;
    }

    .env_tree_list  .icon.sensor_temperature_humidity_with_screen,
    .env_tree_list  .icon.带屏温湿度监测终端{
        background-position: -35px -560px;
    }

    .env_tree_list  .icon.sensor_light_uv,
    .env_tree_list  .icon.光照紫外监测终端{
        background-position: -70px -560px;
    }

    .env_tree_list  .icon.sensor_offline_light_uv,
    .env_tree_list  .icon.手持式光照紫外检测仪{
        background-position: -70px -665px;
    }

    .env_tree_list  .icon.sensor_co2,
    .env_tree_list .icon.二氧化碳监测终端{
        background-position: -105px -560px;
    }

    .env_tree_list  .icon.sensor_offline_co2,
    .env_tree_list  .icon.手持式二氧化碳检测仪{
        background-position: -105px -665px;
    }

    .env_tree_list  .icon.sensor_formaldehyde,
    .env_tree_list  .icon.有机挥发物检测仪{
        /*VOC*/
        background-position: -140px -560px;
    }

    .env_tree_list  .icon.sensor_offline_formaldehyde,
    .env_tree_list  .icon.手持式有机挥发物检测仪{
        /*离线VOC*/
        background-position: -140px -665px;
    }


    .env_tree_list  .icon.甲醛检测仪,
    .env_tree_list  .icon.手持式甲醛检测仪{
        background-position: -385px -665px;
    }

    .env_tree_list  .icon.灯光调控终端{
        background-position: -284px -700px;
    }

    .env_tree_list  .icon.sensor_voc,
    .env_tree_list  .icon.有机挥发物监测终端 {
        background-position: -140px -560px;
    }

    .env_tree_list  .sensor_offline_voc,
    .env_tree_list  .手持式有机挥发物检测仪 {
        background-position: -140px -665px;
    }

    .env_tree_list  .icon.sensor_qcm,
    .env_tree_list  .icon.空气质量监测终端 {
        background-position: -175px -560px;
    }

    .env_tree_list  .icon.sensor_soil_temperature_humidity,
    .env_tree_list  .icon.土壤温湿度监测终端 {
        background-position: -315px -560px;
    }

    .env_tree_list  .icon.sensor_security,
    .env_tree_list  .icon.安防监测终端 {
        background-position: -350px -560px;
    }

    .env_tree_list  .icon.sensor_shock,
    .env_tree_list  .icon.震动监测终端 {
        background-position: -210px -560px;
    }

    .env_tree_list  .icon.network_gateway,
    .env_tree_list  .icon.网关 {
        background-position: 0 -700px;
    }

    .env_tree_list  .icon.network_relay,
    .env_tree_list  .icon.中继 {
        background-position: -35px -700px;
    }

    .env_tree_list  .icon.controller_humidity_machine,
    .env_tree_list  .icon.调湿机 {
        background-position: -70px -700px;
    }

    .env_tree_list  .icon.controller_humidity_cabinet,
    .env_tree_list  .icon.充氮调湿柜 {
        background-position: -210px -700px;
    }

    .env_tree_list .icon.controller_humidity_agent,
    .env_tree_list .icon.调湿剂 {
        background-position: -105px -700px;
    }

    .env_tree_list .icon.sp_sensor_capsule,
    .env_tree_list .icon.智能囊匣{
        background-position: -175px -700px;
    }
    .env_tree_list .icon.智能展柜 {
        background-position: -245px -700px;
    }

    /* #equipment  */
</style>
<!-- 树型环境列表组件 -->
<template id="env_tree_list">
    <div>
        <ul class="env_tree_list" v-for="data in tree_list" track-by="$index">
            <li @click="bubbling">
                <div class="tree_item" :class="[changeName,{checked:sel_list.indexOf(data.env_no)!=-1 }]" :data-env="data.env_no" :data-env-name="data.name">
                	<div class="status_box" @click="fold($event,key)">
                		<span  class="arrow" v-if="data.children" :class="{'open':keyword==data.name||keyword==data.env_no}"></span>
                	</div>
                	<div @click="toggle($event,data.env_no,data.name)" :data-title="data.icon+'-' +data.env_no">
                        <span class="icon " v-if="data.icon" :class="data.icon" :data-title="data.icon" style="top: 3px;"></span>
                        <p :data-title="data.name" :class="{'find':keyword==data.name||keyword==data.env_no}">
	                        {{data.name}}
	                    </p>
	                    <input type="checkbox" :name="data.name" class="rf" :data-name="data.name"  :data-env="data.env_no" :checked="sel_list.indexOf(data.env_no)!=-1" :class="{'show':sel_list.indexOf(data.env_no)!=-1}"/>
                	</div>
                </div>
                <div v-show="keyword==data.name||keyword==data.env_no" v-if="data.children" class="child_menu">
                    <tree-list :tree_list="data.children" :keyword="keyword" :sel_list.sync="sel_list" track-by="data.env_no" :session_key="session_key"></tree-list>
                </div>
            </li>
        </ul>
    </div>
</template>
<script>

var check_memory_tree = function(value){
    if(value){
        $('input[data-env='+value+']')[0].click();
    }
};


Vue.component('tree-list',{
	data:function(){
		return {
			nameList:{
				研究室:'展厅',
				修复室:'展厅',
				库房:'展厅',
				安防展柜:'展柜',
				存储柜:'展柜'
			},
            localNavName:'',
            localNavNo:''
		}
	},
    props:['tree_list','keyword','sel_list','session_key','area'],
    template:'#env_tree_list',
    created:function(){

    },
    ready:function(){
        var tree_list_copy,
            back_from_relic_detail,
            me = this;

//        如果本地有之前窗口选择的环境数据，则将其加载
        if(JSON.parse(sessionStorage.getItem('tree_list_copy'))){
            tree_list_copy = JSON.parse(sessionStorage.getItem('tree_list_copy'));
        }
        if(JSON.parse(sessionStorage.getItem('back_from_relic_detail'))){
            back_from_relic_detail = JSON.parse(sessionStorage.getItem('back_from_relic_detail'));
        }
        if(tree_list_copy&&back_from_relic_detail){
            tree_list_copy = tree_list_copy.split(',');
            if(this.tree_list&&this.tree_list.length!=0){
                this.tree_list.forEach(function(value,index){
                    if(tree_list_copy.indexOf(value.env_no)!=-1){
                        check_memory_tree(value.env_no);
                        me.$dispatch('tree_checked');
                    }
                });
            }
        }
    },
    computed:{
    	changeName:function(){
    		var type=this.tree_list[0].type;
			var asd='';
			if(type==='楼栋'||type==='楼层'||type==='展厅'||type==='展柜'){
				asd=type;
			}else{
				asd=this.nameList[type];
			}
			return asd;
    	}
    },
    methods:{
        toggle:function(e,env_no,env_name){												//选取与取消选取
            var $input=$(e.currentTarget).children('input');
            if(!($input.hasClass('show'))){
                this.$dispatch('sel_env',env_no,$input,env_name);
                //返回被选中环境的环境树
	        	var target=e.target||e.srcElement;
	        	var env_name_arr=[env_name];
	        	$(target).parents('li.key').each(function(){
	        		env_name_arr.push($(this).find('p')[0].innerHTML.trim());
	        	});
                this.$dispatch('full_name',env_name_arr);
            }else{
                this.$dispatch('un_sel_env',env_no,$input,env_name);
            }
        },
        fold:function(e){//下拉
        	var $currentTarget=$(e.currentTarget);
            var el = $currentTarget.find('span')[0];
            $currentTarget.parents('li').eq(0).toggleClass('key');
            if(el&&el.tagName=='SPAN'){
                $(el).toggleClass('open');
                $(el).closest('div.tree_item').next('div').slideToggle('fast');
            }else{
                $(el).find('span.arrow').toggleClass('open');
                $(el).closest('div.tree_item').next('div').slideToggle('fast');
            }
        },
        load_tree:function(sel_env){
            for(var i= 0,len=sel_env.length;i<len;i++){
                var el = $('div.tree_item[data-env='+sel_env[i]+']');
                load_tree(el);
            }
        },
        bubbling:function(e){
        	var element=e.target||e.srcElement;
//      	setTimeout(function(){
	        	if(element.tagName=='P'||element.tagName=='INPUT'){
		        	var $currentTarget=$(e.currentTarget),
		        		$parentsLi=$currentTarget.parents('li').eq(0);
		        	if($parentsLi.hasClass('key'))return;
		        	var status_box=$parentsLi.find('.status_box')[0];
		        	status_box&&status_box.click();
	        	}
//      	},0);
        },
        memory_tree:function(tree_list){
            var me = this;
            if(tree_list&&this.tree_list){
                tree_list.forEach(function(value,index){
                    me.tree_list.forEach(function(n,i){
                        if(n.env_no == value){
                            $(me.$el).children().find('input[data-env='+value+']')[0].click();
                        }
                    });
                });
            }
        }
    },
    events:{
        env_full:function(el){
            el
                .attr('checked',false)
                .toggleClass('show');
        },
        //事件用于处理多关键字查询列表动态展开的效果
//        slide_child:function(){
//            //将子菜单全部收起
//            var item = $('ul.env_tree_list:not(.root)');
//            item.find('div.tree_item').next('div').slideUp('fast');
//            item.find('span.arrow').removeClass('open');
//            var el;
//            if($('div[data-env-name='+this.keyword+']').length!=0){
//                el = $('div[data-env-name='+this.keyword+']');
//            }else{
//                el = $('div[data-env='+this.keyword+']');
//            }
//            load_tree(el);
//        },
        search:function(name,env_no){
        	var key=true,This=this;
        	this.tree_list.forEach(function(con,i){
        		if(!key)return;
        		if(con.name==name&&con.env_no==env_no){
        			key=false;
        			$(This.$el).children().eq(i).find('input')[0].click();
        		}
        	});
        	return key;
        },
        memory_tree:function(tree_list){
            var me = this;
            if(tree_list&&this.tree_list){
                tree_list.forEach(function(value,index){
                    setTimeout(function(){
                        $(me.$el).children().find('input[data-env='+value+']')[0].click();
                    },0);
                });
            }
        },
        click_env:function(info){//设备管理跳转打开tree_list
           console.log('执行一次',info);
            var el = $(this.$el);
            clickEl(info,el);
            if (sessionStorage.getItem('save_env_no')){
                sessionStorage.removeItem('save_env_no');
            }
        }
    }
});
function load_tree(el){
    if(el.length!=0){
        var arr = el.parents('ul.env_tree_list:not(.root)').children('li').children('div.tree_item');
        if(arr){
            $.each(arr,function(i,n){
                $(n).find('span.arrow').addClass('open');
                $(n).next().slideDown('fast');
            });
        }
    }
}
function clickEl(info,el){
    var target = el.children().find('input[data-env='+info+']')[0];
    if(target){
        target.click();
    }else{
        setTimeout(function(){
            clickEl(info,el);
        },1000);
    }
}
</script>




	<!--页码插件-->
	<!--使用方法-->
<!--<page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>-->
<!--参数含义-->
<!--turnPage:父级有一个方法,处理分页组件的页码切换事件-->
<!--page:双向绑定,子组件页码改动,直接反映到父级-->
<!--allPage:总的页数,父组件根据表格高度,计算limit,limit为每页最多条数,分页结果根据每页数量,后台计算总页数-->
<!--count:后台统计,数据记录总数-->
<style>
	/*footer*/
	.clear:after{
		clear: both;
		content: '';
		zoom: 1;
		display: block;
	}
	.equipFooter:after{
		clear: both;
		content: '';
		display: block;
		zoom:1;
		height: 2px;
	}
	.pageList{
	    position: relative;
    	/*left: -50%;*/
		/*页码数字改为居左*/
		left:0;
	}
	.pageList li {
	    list-style: none;
	    padding: 0 8px !important;
	    height: 31px;
		line-height: 31px;
	    float: left;
	    text-align: center;
	    font-size: 16px;
	    color: #9fa3ac;
	    cursor: pointer;
	}
	.pageList li.active {
	    color: #1bbc9b;
	    cursor: pointer;
	}
	.relative{
	    position: relative;
	    display: inline-block;
	    /*left: 50%;*/
		/*页码数字改为居左*/
		left:0;
	}
	.count{
        float: right;
		font-size: 16px;
		color: #9fa3ac;
        height:31px;
        line-height: 31px;;
	}
</style>
<!-- 分页 页码 模板 -->
<template id="pageList">
	<div class="equipFooter">
		<div class="relative" v-show="count!=0">
			<ul @click="changePage" class="pageList clear">
				<li class="back" @click="back"></li>
				<li :class="{'active':page==1}">1</li>
				<li class="omit" v-show="key.left">...</li>
				<li v-for="num in pages" :class="{'active':page==num}" v-text="num"></li>
				<li class="omit" v-show="key.right">...</li>
				<li v-text="allpage" v-show="allpage>1" :class="{'active':page==allpage}"></li>
				<li class="next" @click="next"></li>
			</ul>
		</div>
		<span class="count" style="margin-right:20px;">数据总数：{{count||0}}</span>
	</div>
</template>


<script>
	Vue.component('page-list',{
		template:'#pageList',
		props:['page','allpage','count'],
		computed:{
			pages:function(){
				var obj=fn_each(this.page,this.allpage);
				this.key.left=obj.left;
				this.key.right=obj.right;
				return obj.arr;
			}
		},
		data:function(){
			return {
				key:{
					left:false,
					right:false
				}
			}
		},
		methods:{
			changePage:function(e){
				var element=e.target||e.srcElement,
					newPage=parseInt($(element).html());
				if(isNaN(newPage)){
					return false;
				}
				this.page=newPage;
				this.changeActive();
			},
			back:function(){
				this.page--;
				if(this.page<1){
					this.page=1;
				}
				this.changeActive();
			},
			next:function(){
				this.page++;
				if(this.page>this.allpage){
					this.page=this.allpage||1;
				}
				this.changeActive();
			},
			changeActive:function(){
				this.$dispatch('turn-page');
			}
		},
		events:{
			'resetPage':function(page){
//			    console.log(page);
				this.page=page||1;
				this.changeActive();
			}
		}
	});
	
	var fn_each=each(isAllPage_10,isPage_between,isPage_1_4,isPage_Max_4);
	
	function each(){
		var fn_list=Array.prototype.slice.call(arguments);
		return function(){
			for(var i=0,len=fn_list.length;i<len;i++){
				var key=fn_list[i].apply(this,arguments);
				if(key!==false){
					return key;
				}
			}
		}
	}
	function isAllPage_10(page,allPage){		//页码总数9个及9个以内
		var arr=[];
		if(allPage<=10){
			for(var i=2;i<allPage;i++){
				arr.push(i);
			}
			return {
				arr:arr,
				left:false,
				right:false
			};
		}
		return false;
	}
	function isPage_1_4(page,allPage){			//页码在1到其后面4个
		var arr=[];
		if(page<=5){
			for(var i=2;i<=6;i++){
				arr.push(i);
			}
			return {
				arr:arr,
				left:false,
				right:true
			};
		}
		return false;
	}
	function isPage_Max_4(page,allPage){			//页码在MAX页到其前面4个
		var arr=[];
		if(page>=(allPage-4)){
			for(var i=allPage-1;i>=allPage-5;i--){
				arr.push(i);
			}
			return {
				arr:arr.reverse(),
				left:true,
				right:false
			};
		}
		return false;
	}
	function isPage_between(page,allPage){			//页码同时不满足前两种条件
		var arr=[];
		if(page>5&&page<(allPage-4)){
			for(var i=page-2;i<=page+2;i++){
				arr.push(i);
			}
			return {
				arr:arr,
				left:true,
				right:true
			};
		}
		return false;
	}

</script>

	<!--时间插件-->
	<style>
	.time_box{
        line-height: 31px;
    	padding-top: 14px;
	}
	.time_box span,.typeBox>span{
        color: #888d92;
	    font-size: 14px;
	    padding: 0 15px;
	    height: 29px;
	    border: 1px solid #9a9ea2;
	    line-height: 29px;
	    text-align: center;
	    float: left;
	    cursor: pointer;
	    margin-right: -1px;
	    border-radius: 5px;
	}
	.time_box p{
        border: 0;
		font-size: 16px;
	    float: left;
	    padding-left: 26px;
	    width: 75px;
	    color: #5b6273;
	}
	.time_box span:hover,.time_box span.active{
		color: #ffffff;
		background: #59bfaa;
	}
	.diy{
        margin-left: -74px;
	    height: 29px;
	    background: #fff;
	    border: 1px solid #9a9ea2;
	    line-height: 29px;
	    float: left;
	}
	.diy input.start_time,.diy input.end_time{
		height:20px;
		position: relative;
		top:-1px;
	}
	.diy div.button{
		height:29px;
		position: relative;
		top:-1px;
	}
</style>

<!--时间选择-->
<template id="time_box">
	<div class="time_box clear">
		<p>时间选择</p>
		<span @click="change('24h',$event)" class="24h" :class="{'active':time=='24h'}">24h</span><span @click="change('today',$event)" class="today" :class="{'active':time=='today'}">今天</span><span @click="change('week',$event)" class="week" :class="{'active':time=='week'}">本周</span><span @click="change('month',$event)" class="month" :class="{'active':time=='month'}">本月</span><span @click.stop="change('diy',$event)" class="+" :class="{'active':time!='24h'&&time!='today'&&time!='week'&&time!='month'}">自定义</span>
		<div class="diy" v-show="showHide">
			<input placeholder="请输入日期" class="start_time" class="laydate-icon" @click="openDatePicker('start')" >
			<input placeholder="请输入日期" class="end_time" class="laydate-icon" @click="openDatePicker('end')" >
			<div class="button" @click="diyTimePost">确定</div>
		</div>
	</div>
</template>

<script>
	/*
	* 2016-9-23 by:曾竞
	*
	* 对时间控件进行了调整:增加判断自定义时间区间条件下,时间起始和终止的判断
	* 对时间控件进行了调整:将active样式的添加调整为Vue样式绑定方式,弃用了jquery查找元素方式
	*
	* */
	Vue.component('time-box',{
		template:'#time_box',
		props:{
			time:'time',
			pickTime:'pickTime'
		},
		data:function(){
			return {
				showHide:false
			}
		},
		methods:{
		    openDatePicker:function(type){
                laydate();
			},
			change:function(time){
				this.time=time;
				if(time=='diy'){
					this.diyShowHide();
				}else{
					this.timeChange(time);
					this.showHide=false;
				}
			},
			timeChange:function(time){
				var This=this;
				this.$dispatch('time-change',time);
			},
			diyShowHide:function(){
				this.showHide=!this.showHide;
			},
			diyTimePost:function(e){
				var correct = false;//标识时间选择是否正常
				var element=e.target||e.srcElement;
				var $input=$(element).siblings('input');

				var time='';
				var start_time = $input.filter('.start_time').val();
				var end_time = $input.filter('.end_time').val();
				console.log(start_time,end_time)
				if(start_time==''){
					alert('请选择时间起点!');
				}else if(end_time==''){
					alert('请选择时间终点!');
				}else{
					start_time=start_time.split('-');
					end_time=end_time.split('-');
					if(start_time[0]<end_time[0]){//比较年份
						correct = true;
					}else if(start_time[0]==end_time[0]){
						if(start_time[1]<end_time[1]){//比较月份
							correct = true;
						}else if(start_time[1]==end_time[1]){
							if(start_time[2]<end_time[2]){//比较日期
								correct = true;
							}
						}
					}
					if(correct){
						$input.each(function(){
							time+=$(this).val()+','
						});
						time=time.slice(0,time.length-1);
						this.timeChange(time);
					}else{
						alert('时间终点必须在时间起点之后!');
					}
				}
			}
		}
	});

</script>

	<!--文物全筛选插件-->
	<style>
.cultural_relics_screening{
	overflow: hidden;
    background: #EBF0F4;
    position: absolute;
    z-index: 9;
    padding-right: 17px;
}

.cultural_relics_screening.active{
	position: fixed;
	z-index: 1;
}

.cultural_relics_screening .fliter_box{
	cursor: pointer;
}
.fliter_box font{
    font-size: 12px;
    color: #76aed5;
    cursor: pointer;
    line-height: 42px;
}
.fliter_box .ability{
    margin-top: 9px;
}
.filterChooce{
    position: relative;
    border-bottom: 1px solid #ccc;
    line-height: 30px;
}
.filterChooce span{
    font-size: 14px;
    color: #979797;
    display: inline-block;
    padding: 0 0 0 2%;
}
.filterChooce span.typeName{
    position: absolute;
    top: 0;
    height: 100%;
    border-bottom: 1px solid #ccc;
    color: #5b6273;
}
.filterChooce span:not(.typeName):hover{
	text-decoration: underline;
    cursor: pointer;
}
.filterChooce .pWrap{
    margin: 0 100px 0 103px;
    height: 30px;
    overflow: hidden;
}
.filterChooce p span{
    font-size: 14px;
}
.filterChooce .showHide{
    right: 0;
	float: right;
    width: 46px;
    height: 20px;
    border: 1px solid #1bbc9b;
    font-size: 12px;
    color: #9fa3ac;
    line-height: 20px;
    padding-left: 13px;
    border-radius: 3px;
    position: relative;
    cursor: pointer;
    top: 4px;
    padding-right: 31px;
}
.filterChooce .showHide span{
    position: absolute;
    right: -7px;
    top: 0;
    width: 30px;
    height: 20px;
}
.filterChooce .showHide span.active{
	background-position-y:-430px;
}
.filter_content{
	/*display: none;*/
	height: 0;
	overflow: hidden;
}
.relicFilterList{
	max-height:55px;
	overflow:scroll;	
}
</style>
<!--文物筛选-->
<template id="cultural_relics_screening_template">
	<div class="cultural_relics_screening permissionHidden" @mouseenter="slideEnter" @mouseleave="slideLeave" v-permission="{name:'文物管理'}">
		<div class="fliter_box">
			<div class="ability">
				<!--<div v-text="the_form_change"></div>-->
			</div>
			<p class="relicFilterList">筛选条件 :
				<template v-for="(type,obj) in filterContent">
					<span @click="removeFilter(type,name)" class="filterItem" v-for="name in obj">
						{{name}}
						<i class="removeBtn"></i>
					</span>
				</template>
				<font v-show="showOrHide" @click="allClear" style="white-space: nowrap">清空筛选</font>
			</p>
		</div>
		<div class="filter_content" @click="packUp($event)">
			<div class="getHeight">
				<div class="filterChooce" v-if="!hideFilter||(hideFilter&&hideFilter.indexOf('保存状态')===-1)">
					<span class="typeName">保存状态</span>
					<div class="pWrap">
						<p @click="addFilter('status',$event)">
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('待入库')!==-1)">待入库</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('不需修复')!==-1)">不需修复</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('需要修复')!==-1)">需要修复</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('亟需修复')!==-1)">亟需修复</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('展陈')!==-1)">展陈</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('科研')!==-1)">科研</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('修复')!==-1)">修复</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('巡展')!==-1)">巡展</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('借出')!==-1)">借出</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('已归还')!==-1)">已归还</span>
							<span v-show="!hideFilter||!(hideFilter&&hideFilter.indexOf('借入')!==-1)">借入</span>
						</p>
					</div>
				</div>
				<div v-for="(name,filter) in relic_filter" class="filterChooce" v-if="!hideFilter||!(hideFilter&&hideFilter.indexOf(rename(name))!==-1)">
					<span v-text="rename(name)" class="typeName"></span>
					<div class="showHide" @click="showHide($event)">展开</div>
					<div class="pWrap">
						<p @click="addFilter(name,$event)">
							<span :class="resetClass(parent,name)" v-for="(parent,obj) in filter" v-if="obj.name" v-text="obj.name"></span>
						</p>
					</div>
				</div>
				<div class="filterChooce" v-if="!hideFilter||!(hideFilter&&hideFilter.indexOf('等级')!==-1)">
					<span class="typeName">等级</span>
					<div class="pWrap">
						<p @click="addFilter('level',$event)">
							<span>一级文物</span><span>二级文物</span><span>三级文物</span><span>一般文物</span><span>未定级文物</span>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</template>	

<script>
    var hideFilter = [
        '保存状态',
        '年代',
        '类别',
        '位置',
        '材质',
        '等级',

        '待入库',
        '不需修复',
        '需要修复',
        '亟需修复',
        '展陈',
		'科研',
        '修复',
        '巡展',
        '借出',
        '已归还',
        '借入',
    ];
//	状态列表
	Vue.component('cultural-relics',{
		template:'#cultural_relics_screening_template',
		props:['relic_filter','hide_filter'],//,'key_isreturn'
		data:function(){
			return {
				filterContent:{
					level:[],
					status:[]
				},
				hall:[],
				the_form_change:'展开筛选',
				filter_content:'',
				$getHeight:null,
                hideFilter:[],
			}
		},
		created:function(){

		},
		ready:function(){
			var el=this.$el,$relic=$('#relic');
			el.style.width=$relic.width()-17+'px';
			window.onresize=function(){
				el.style.width=$relic.width()-17+'px';
			};
			this.filter_content=$(el).find('.filter_content');
			this.$getHeight=this.filter_content.find('.getHeight');
            this.hideFilter = this.hide_filter;
//            console.log(this.hideFilter);
		},
		methods:{
			resetClass:function(parent,name){
				if(name!='hall'){
					return;
				}
				return parent;
			},
			postData:function(){
				// console.log(this.filterContent);
				this.$dispatch('new-data',this.filterContent,this.hall);
			},
			rename:function(name){
				this.$set('filterContent.'+name,[]);
				return nameList[name];
			},
			showHide:function(e){
				var element=e.target||e.srcElement,
					$element=$(element),
					$p=$element.next();
					
				setTimeout(function(){
					var bool=$element.html()=='展开',height;
					$element.html(bool?'收起':'展开');
					if(!bool){
						$element.removeClass('active');
						height=30;
					}else{
						$element.addClass('active');
						height=$p.children().height()-1;
					}
					$p.stop().animate({'height':height},300);
				},0);
			},
			packUp:function(e){
				var element=e.target||e.srcElement;
				if(element.className!='showHide'){
					return;
				}
				this.filter_content.children().find('.pWrap')
					.animate({'height':30},300)
					.prev('.showHide').not($(element)).html('展开').removeClass('active');
			},
			addFilter:function(type,e){
//			    console.log(type);
			    //添加一个筛选条件
//				if(!this.key_isreturn){
//					return;
//				}
				var element=e.target||e.srcElement;
					if(element.tagName!='SPAN'){
						return;
					}

				if(type=='hall'&&element.className){
					var hallIndex=this.hall.indexOf(element.className);
					if(hallIndex!=-1){
						this.hall.splice(hallIndex,1);
					}else{
						this.hall.push(element.className);
					}
				}
				
				var val=element.innerHTML.replace(/&nbsp;/g,''),
					type=this.filterContent[type],
					index=type.indexOf(val);
					
				if(index!=-1){
					type.splice(index,1);
				}else{
					type.push(val)
				}
				this.postData();
			},
			removeFilter:function(type,name){
//				if(!this.key_isreturn){
//					return;
//				}
				if(type=='hall'){
					this.hall.splice(this.filterContent.hall.indexOf(name),1);
				}

				this.filterContent[type].splice(this.filterContent[type].indexOf(name),1);
				this.postData();
			},
			allClear:function(){
//				if(!this.key_isreturn){
//					return;
//				}
				var filter=this.filterContent;
				for(var i in filter){
					filter[i]=[];
				}
				this.hall=[];
				this.postData();
			},
			slideEnter:function(){
				this.the_form_change='收起筛选';
				$(this.$el).find('>div:last').stop().animate({height:this.$getHeight.height()},300,function(){
					$(this).css({'height':'auto'});
				});
			},
			slideLeave:function(){
				this.the_form_change='展开筛选';
				$(this.$el).find('>div:last').stop().animate({height:0});
			}
		},
		computed:{
			showOrHide:function(){
				var num=0,
					filterContent=this.filterContent;

				for(var i in filterContent){
					num+=filterContent[i].length;
				}
				return num;
			},
		}
	});

	var nameList={
		'age':'年代',
		'category':'类别',
		'hall':'位置',
		'material':'材质'
	};

</script>

	<!--统计echarts-->
	
<style>
#relic .scrollWrap .statistical{
    background:#ffffff;
}


.echartsTotal{
	height: 363px;
}
.totalView{
    position: relative;
}
.totalView>div{
    height: 272px;
    margin-top: 46px;
}
.totalView .title{
    width: 80px;
    color: #6c7177;
}
.totalView .num{
    margin-top: 18px;
    display: block;
    font-size: 55px;
    color: #9fa3ac;
    margin-left: -4px;
    margin-bottom: 9px;
}
.totalView .footer{
    font-size: 16px;
    color: #9fa3ac;
    margin-left: 10px;
}
.totalNum{
    width: 261px;
    height: 100%;
    padding-left: 34px;
    position: absolute;
    top: -46px;
}
.clear:after{
	display: block;
	content: '';
	clear: both;
}
.echartsView{
    margin-left: 295px;
}
.echartsView>div{
    width: 50%;
    float: left;
}
.echarts_wrap{
	width: 100%;
	height: 246px;
}
</style>

<!--统计echarts-->
<template id="statistical_echarts_template">
	<div class="statistical">
		<div class="functionName">文物数量</div>
		<div class="totalView clear">
			<div class="echartsView">
				<div class="echartsType">
					<span class="title">文物类型统计</span>
					<div class="echarts_wrap"></div>
				</div>
				<div class="echartsAge">
					<span class="title">文物年代统计</span>
					<div class="echarts_wrap"></div>
				</div>
			</div>
			<div class="totalNum">
				<span class="title">文物总数</span>
				<span class="num" v-text="relicTotal"></span>
				<span class="footer">TOTAL RETURNS</span>
			</div>
		</div>
	</div>
</template>

<script>
	Vue.component('statistical-echarts',{
		template:'#statistical_echarts_template',
		data:function(){
			return {
				relicTotal:0,
				echartsType:{},
				echartsAge:{},
				defaultOption:{},
				relic_type:{},
				relic_age:{}
			}
		},
		ready:function(){
			var This=this;
			this.echartsType=echarts.init($(this.$el).find('.echarts_wrap')[0]);
			this.echartsAge=echarts.init($(this.$el).find('.echarts_wrap')[1]);
			
			$(window).resize(function(){
				This.echartsType.resize();
				This.echartsAge.resize();
			});
			this.createOption();
		},
		methods:{
			getData:function(name){
				(name=='type')?this.echartsTypeData():this.echartsAgeData(); 				
			},
			echartsTypeData:function(){
				this.echartsType.setOption(this.defaultOption);
				var legendData=[],
					seriesData=[],
					relic_type=this.relic_type;
				for(var i in relic_type){
					seriesData.push({
						value:relic_type[i],
						name:i,
//						selected:true
					});
				}
				this.echartsType.setOption({
					series:{data:seriesData}
				});
				this.echartsType.resize();
			},
			echartsAgeData:function(){
				this.echartsAge.setOption(this.defaultOption);
				var legendData=[],
					seriesData=[],
					relic_age=this.relic_age;
				for(var i in relic_age){
					seriesData.push({
						value:relic_age[i],
						name:i,
//						selected:true
					});
				}
				this.echartsAge.setOption({
					series:{data:seriesData}
				});
				this.echartsAge.resize();
			},
			createOption:function(){//创建默认的饼图配置对象
				this.defaultOption = {
				    tooltip: {
				        trigger: 'item',
				        formatter: "{b}: {c} ({d}%)"
				    },
				    series: [
				        {
				            type:'pie',
				            radius: ['30%', '50%'],
				            center:['50%','50%'],
				            data:[]
				        }
				    ]
				};
			}
		},
		events:{
			showLoad:function(){
				var This=this;
				setTimeout(function(){
					showLoading(This.echartsType);
					showLoading(This.echartsAge);
				},0);
			},
			relic_type:function(data){
				this.echartsType.hideLoading();
				this.echartsAge.hideLoading();
				if(data=='[]'){
					data=[];
				}
				this.relic_type=data;
				this.getData('type');

				var num=0;
				for(var i in data){
					num+=data[i]*1;
				}
				this.relicTotal=num;
			},
			relic_age:function(data){
				if(data=='[]'){
					data=[];
				}
				this.relic_age=data;
				this.getData('age');
			}
		}
	});
	
	function showLoading(chart){
		chart.showLoading('default',{
		    color:'#5A9E6D',
		    text:'正在努力加载ing...',
		    textColor:'#ccc',
		    maskColor:'rgba(159,163,172,0.2)'
		});
	}
</script>

	<!--动态变化数字-->
	<style>
	.changes_digital{
	    height: 35px;
    	overflow: hidden;
	}
	.changes_digital ul{
		float: left;
		width: 12px;
		list-style: none;
		position: relative;
		top: 0;
		transition: top 0.5s;
	}
	.changes_digital ul li{
		line-height: 35px;
	}
</style>
<template id="changes_digital_template">
	<div class="changes_digital clear">
		<ul-num v-for="i in newNum" :index="i" track-by="$index"></ul-num>
	</div>
	<slot></slot>
</template>
<template id="ulNum">
	<ul :style="{top:top_+'px'}">
		<li>0</li>
		<li>1</li>
		<li>2</li>
		<li>3</li>
		<li>4</li>
		<li>5</li>
		<li>6</li>
		<li>7</li>
		<li>8</li>
		<li>9</li>
	</ul>
</template>
<script>
	Vue.component('changes-digital',{
		template:'#changes_digital_template',
		props:['num'],
		computed:{
			newNum:function(){
				return this.num.split('');
			}
		},
		components:{
			'ul-num':{
				template:'#ulNum',
				props:['index'],
				computed:{
					top_:function(){
						return -35*this.index;
					}
				}
			}
		}
	});
</script>


	<!--文物管理-->
	<template id="relic_template">
	<div id="relic_container">
		<div id="relic" class="relic_manage">
			<div class="header">
				<div class="title" v-text="configLanguage.left_relicManagement_long"></div>
				<div class="filterWrap">
					<filter-component type="relic_manage"></filter-component>
				</div>
				<div class="ability">
					<div @click="relicsOverviewSheet">导出藏品概览表</div>
					<div @click="goRelicsStorage">藏品入库</div>
					<div @click="goRelicsOutStorage">藏品出库</div>
					<div @click="goRelicsCheck">藏品盘点</div>
				</div>
			</div>
			<!--藏品筛选-->
			<!--:key_isreturn.sync=isreturn-->
			<!--<cultural-relics @new-data="resetOption" :relic_filter="relic_filter" :hide_filter="hideFilter"></cultural-relics>-->
			<!--<div class="scrollWrap permissionHidden" @scroll="scroll" v-permission="{name:'藏品管理'}">-->
				<!--<div class="scrollContent">-->
					<!--&lt;!&ndash;统计echarts&ndash;&gt;-->
					<!--<statistical-echarts></statistical-echarts>-->
					<!--&lt;!&ndash;瀑布流&ndash;&gt;-->
					<!--<div class="relicWaterfall">-->
						<!--<div class="relicWrap">-->
							<!--<div class="relic" v-for="relic in waterfall" @click="jumpDetails(relic.relic_no)">-->
								<!--<div class="options"></div>-->
								<!--<div class="equipView">-->
									<!--<img :src="relic.image||'images/default.png'">-->
									<!--<p class="equipName textOver" v-text="relic.name"></p>-->
									<!--<ul>-->
										<!--<li><span class="equipLocation category" v-text="relic.category"></span></li>-->
										<!--<li><span class="equipLocation age" v-text="relic.age"></span></li>-->
										<!--<li><span class="equipLocation" v-text="rename(relic.nav)"></span></li>-->
									<!--</ul>-->
								<!--</div>-->
								<!--<div class="footer">-->
									<!--<p><span class="humidityTitle">{{relic.new_data.humidity||'-'}}%</span></p>-->
									<!--<p><span class="temperatureTitle">{{relic.new_data.temperature||'-'}}℃</span></p>-->
								<!--</div>-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->
				<!--&lt;!&ndash;<div class="drag"></div>&ndash;&gt;-->
			<!--</div>-->
		</div>
		<div class="relicTableContainer">
			<div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
				<!--<p>这里显示藏品图片</p>-->
				<img :src="img_src" :alt="img_src"/>
			</div>
			<div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
				<!--<p>这里显示地理位置信息</p>-->
				<div class="view">
					<div class="point" :data-title="nav_name"></div>
					<img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
				</div>
			</div>
			<!--显示表格数据-->
			<section class="tableWrap">
				<table>
					<thead>
					<tr>
						<th width="4%">
							<!--:indeterminate="true" 部分选中状态-->
							<!---->
							<input type="checkbox" v-model="allStatus" @click="changeStatus" />
						</th>
						<th>
							状态
						</th>
						<th>
							藏品名称
						</th>
						<th>
							总登记号
						</th>
						<th>
							材质
						</th>
						<th>
							类型
						</th>
						<th>
							等级
						</th>
						<th>
							年代
						</th>
						<th>
							位置
						</th>
						<th>
							最新数据
						</th>
					</tr>
					</thead>
					<tbody>
					<tr v-for="relic in tableData">
						<td>
							<!--:checked="selRelics.indexOf(relic.relic_no)!=-1"-->
							<input type="checkbox" v-if="relic&&relic.relic_no" :value="relic.relic_no" v-model="selRelics" @click="changeRelic(relic.relic_no)"/>
						</td>
						<td>
							<!--{no_need_repair:relic.status=='不需修复'||relic.status=='无需修复',need_repair:relic.status=='需要修复',need_repair_asap:relic.status=='亟需修复'||relic.status=='亟待修复',in:relic.status=='展出'||relic.status=='修复中'||relic.status=='修复'||relic.status=='研究中'||relic.status=='研究'||relic.status=='已归还',out:relic.status=='借出'||relic.status=='借入'}-->
							<span class="relic_status_item" :class="relic.status">{{relic.status||'无状态信息'}}</span>
						</td>
						<td class="left relic_name_no" style="position: relative;">
							<p style="cursor: pointer;padding-left: 30px" @click="jumpDetails(relic.relic_no)">
								<img v-if="relic.image" style="vertical-align: middle;margin-right:5px;" :src="relic.image" :alt="" @mouseenter.stop="show_big_img($event,relic.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{relic.name}}</span>
								<!--<span class="relic_no">{{relic.relic_no}}</span>-->
							</p>
						</td>
						<td>
							<!--{{relic.relic_no||''}}-->
							{{relic.relic_id||''}}
						</td>
						<td>
							{{relic.material}}
						</td>
						<td>
							{{relic.category}}
						</td>
						<td>
							{{relic.level}}
						</td>
						<td>
							{{relic.age}}
						</td>
						<td class="left">
							<!--@click="goEnvDetail(relic.parent_env_no)"位置图不提供跳转功能-->
							<p style="position: relative;padding-left: 25px;">
								<a href="javascript:void(0)" @click="goEnvDetail(relic.parent_env_no)">
									<span v-if="relic.map&&relic.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,relic.map,relic.locate,relic)" @mouseleave="hide_big_nav"></span>
								{{nav_info(relic.nav)||'暂无位置信息'}}</a>
							</p>
						</td>
						<td>
							<!--{{relic.new_data}}-->
							<span v-if="relic.new_data.temperature">温度:{{relic.new_data.temperature}}</span>
							<span v-if="relic.new_data.humidity">湿度:{{relic.new_data.humidity}}</span>
						</td>
					</tr>
					</tbody>
				</table>
			</section>
			<!--显示分页页码-->
			<footer>
				<page-list class="permissionHidden" @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count" v-permission="{name:'设备管理'}"></page-list>
			</footer>
			<div class="loading" v-show="tableLoading"></div>
		</div>
		<!--<div class="contentFooter" :class={active:showLoading} v-text="footer" v-show="showfooter"></div>-->
		<!--<div class="shadow" v-show="show_key"></div>-->
		<!--<div v-show="show_key" class="fixedShadow"></div>-->
		<add-relic transition="alert" :key.sync="show_key" v-if="show_key"></add-relic>
	</div>
</template>




	<!--文物入库-->
	<template id="relicsStorage">
    <div class="moduleContainer">
        <header>
            <div @click="goBack" class="topTitle">
                <Icon type="chevron-left"></Icon>藏品入库
            </div>
            <div class="filterWrap">
                <filter-component type="relic_manage" hide-type="in"></filter-component>
            </div>
            <div class="topFunction">
                <i-button type="ghost" @click="showUpload">导入藏品图片</i-button>
                <i-button type="ghost" @click="showUpload">批量导入藏品</i-button>
                <i-button type="ghost" @click="addRelic" class="permissionHidden" v-permission="{name:'添加文物'}">添加藏品</i-button>
                <i-button type="ghost" @click="okHandler">入库</i-button>
            </div>
        </header>
        <section>
            <!--藏品筛选-->
            <!--<cultural-relics @new-data="resetOption" :relic_filter="relic_filter" :hide_filter="hideFilter"></cultural-relics>-->

            <div class="relicTableContainer">
                <div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
                    <!--<p>这里显示藏品图片</p>-->
                    <img :src="img_src" :alt="img_src"/>
                </div>
                <div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
                    <!--<p>这里显示地理位置信息</p>-->
                    <div class="view">
                        <div class="point" :data-title="nav_name"></div>
                        <img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
                    </div>
                </div>
                <!--显示表格数据-->
                <section class="tableWrap">
                    <table>
                        <thead>
                        <tr>
                            <th width="4%">
                                <!--:indeterminate="true" 部分选中状态-->
                                <input type="checkbox" v-model="allStatus" @click="changeStatus"/>
                            </th>
                            <th>
                                状态
                            </th>
                            <th>
                                藏品名称
                            </th>
                            <th>
                                总登记号
                            </th>
                            <th>
                                材质
                            </th>
                            <th>
                                类型
                            </th>
                            <th>
                                等级
                            </th>
                            <th>
                                年代
                            </th>
                            <th>
                                位置
                            </th>
                            <!--<th>-->
                                <!--最新数据-->
                            <!--</th>-->
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="relic in tableData">
                            <td>
                                <!--:checked="selRelics.indexOf(relic.relic_no)!=-1"-->
                                <input type="checkbox" v-if="relic&&relic.relicNo" :value="relic.relicNo" v-model="selRelics" @click="changeRelic(relic)"/>
                            </td>
                            <td>
                                <!--{no_need_repair:relic.status=='不需修复'||relic.status=='无需修复',need_repair:relic.status=='需要修复',need_repair_asap:relic.status=='亟需修复'||relic.status=='亟待修复',in:relic.status=='展出'||relic.status=='修复中'||relic.status=='修复'||relic.status=='研究中'||relic.status=='研究'||relic.status=='已归还',out:relic.status=='借出'||relic.status=='借入'}-->
                                <span class="relic_status_item" :class="relic.status">{{relic.status||'无状态信息'}}</span>
                            </td>
                            <td class="left relic_name_no" style="position: relative;">
                                <p style="cursor: pointer;padding-left: 30px" @click="jumpDetails(relic.relicNo)">
                                    <img v-if="relic.image" style="vertical-align: middle;margin-right:5px;" :src="relic.image" :alt="" @mouseenter.stop="show_big_img($event,relic.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{relic.name}}</span>
                                    <!--<span class="relic_no">{{relic.relic_no}}</span>-->
                                </p>
                            </td>
                            <td>
                                {{relic.relicId||''}}
                                <!--{{relic.relicNo||''}}-->
                            </td>
                            <td>
                                {{relic.material}}
                            </td>
                            <td>
                                {{relic.category}}
                            </td>
                            <td>
                                {{relic.level}}
                            </td>
                            <td>
                                {{relic.age}}
                            </td>
                            <td class="left">
                                <!--@click="goEnvDetail(relic.parent_env_no)"位置图不提供跳转功能-->
                                <p style="position: relative;padding-left: 25px;">
                                    <span v-if="relic.map&&relic.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,relic.map,relic.locate,relic)" @mouseleave="hide_big_nav"></span>
                                    {{nav_info(relic.nav)||'暂无位置信息'}}
                                </p>
                            </td>
                            <!--<td>-->
                                <!--&lt;!&ndash;{{relic.new_data}}&ndash;&gt;-->
                                <!--<span v-if="relic.new_data&&relic.new_data.temperature">温度:{{relic.new_data.temperature}}</span>-->
                                <!--<span v-if="relic.new_data&&relic.new_data.humidity">湿度:{{relic.new_data.humidity}}</span>-->
                            <!--</td>-->
                        </tr>
                        </tbody>
                    </table>
                </section>
                <!--显示分页页码-->
                <footer>
                    <page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>
                </footer>
                <div class="loading" v-show="tableLoading"></div>
            </div>
        </section>
        <add-relic transition="alert" :key.sync="show_key" v-if="show_key"></add-relic>
        <Modal
                title="藏品入库"
                :visible.sync="modalVisible"
                class-name="vertical-center-modal"
                :mask-closable="false"
                :scrollable="false"
        >
            <div>
                <Row type="flex" align="top">
                    <i-col span="5">
                        <p style="text-align: left;line-height: 32px;">
                            入库状态选择 :
                        </p>
                    </i-col>
                    <i-col span="10">
                        <i-select :model.sync="status">
                            <Option-group label="库藏藏品">
                                <i-option value="不需修复">不需修复</i-option>
                                <i-option value="需要修复">需要修复</i-option>
                                <i-option value="亟需修复">亟需修复</i-option>
                            </Option-group>
                            <!--<Option-group label="离库藏品">-->
                                <!--<i-option value="展陈">展陈</i-option>-->
                                <!--<i-option value="科研">科研</i-option>-->
                                <!--<i-option value="修复">修复</i-option>-->
                                <!--<i-option value="巡展">巡展</i-option>-->
                                <!--<i-option value="借出">借出</i-option>-->
                            <!--</Option-group>-->
                        </i-select>
                    </i-col>
                    <i-col span="9">
                        <p style="text-align: right;line-height: 32px;padding-right:15px;">
                            选中藏品数量: {{modalTableData.length}} 件
                        </p>
                    </i-col>
                </Row>
                <div class="modalTabelContainer">
                    <table>
                        <thead>
                        <tr>
                            <th>藏品名称</th>
                            <th>总登记号</th>
                            <th>材质</th>
                            <th>等级</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="relic in modalTableData" track-by="$index">
                            <td>{{relic.name}}</td>
                            <td>{{relic.relicId}}</td>
                            <!--<td>{{relic.relicNo}}</td>-->
                            <td>{{relic.material}}</td>
                            <td>{{relic.level}}</td>
                            <td>
                                <Icon type="android-close" size="18" color="red" style="cursor:pointer;" @click="removeRelic(relic)"></Icon>
                            </td>
                        </tr>
                        <tr v-show="!modalTableData||modalTableData.length===0">
                            <td colspan="5">
                                未选中入库藏品
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div slot="footer">
                <i-button type="primary" @click="storage_ok">确认入库</i-button>
                <i-button type="ghost" @click="storage_cancel">取消</i-button>
            </div>
        </Modal>
        <!--:mask-closable="false"-->
        <Modal
                title="批量导入藏品"
                :visible.sync="relicUploadVisible"
                class-name="vertical-center-modal"
                :scrollable="false"
        >
            <div>
                <!--上传一些好东西-->
                <div style="text-align:center;">
                    <a href="javascript:void(0)" @click="downloadTemplate">
                        模版下载地址
                    </a>
                </div>
                <!--<form :action="uploadUrl" method="post" enctype='multipart/form-data' accept-charset="UTF-8">-->
                    <!--<input type="file" name="file">-->
                    <!--<button type="submit">确定提交</button>-->
                <!--</form>-->

                <Upload
                    type="drag"
                    name="file"
                    :action="uploadUrl",
                    :format="['xls','xlsx']",
                    :on-success="handleSuccess"
                    :on-format-error = "handleFormatError",
                    :accept="xls,xlsx">
                    <div style="padding: 20px 0">
                        <Icon type="ios-cloud-upload" size="52" style="color: #3399ff"></Icon>
                        <p>点击或将文件拖拽到这里上传</p>
                    </div>
                </Upload>
            </div>
            <div slot="footer">
                <!--<i-button type="primary" @click="storage_ok">确认入库</i-button>
                <i-button type="ghost" @click="storage_cancel">取消</i-button>-->
            </div>
        </Modal>

        <!-- 添加文物图片Madal -->
        <Modal
            title = "导入藏品图片"
            :visible.sync = "relicPicUploadVisible"
            class-name = "vertical-center-modal"
            :scrollable = "false" 
        >
            <Upload
                type="drag"
                name="file"
                :action="uploadPicUrl",
                :format="['zip']",
                :on-success="handleSuccess"
                :on-format-error = "handleFormatError",
                :accept="zip">
                <div style="padding: 20px 0">
                    <Icon type="ios-cloud-upload" size="52" style="color: #3399ff"></Icon>
                    <p>点击或将文件拖拽到这里上传</p>
                </div>
            </Upload>
            <div slot="footer"></div>
        </Modal>
    </div>
</template>

<!-- 添加文物 模板 -->
<template id="addDataRelic">
    <div class="alertBox addData" style="position: absolute;z-index: 999">
        <header>
            添加藏品
            <Icon type="close-round" size="20" class="close" @click="close"></Icon>
        </header>
        <section>
            <div class="communicationInfo">
                <h5>通讯信息</h5>
                <h6>总登记号</h6>
                <input type="text" v-model="addData.relic_id" @change="loginRelic"/>
                <h6>藏品名字</h6>
                <input type="text" v-model="addData.name"/>
                <h6>材质</h6>
                <select v-model="addData.material" @change="meterial_change">
                    <!--<option v-for="material in material_list" v-show="material.name" :value="material.name">{{material.name}}</option>-->
                    <option>石质</option>
                    <option>陶器</option>
                    <option>瓷器</option>
                    <option>铁质</option>
                    <option>青铜</option>
                    <option>纸质</option>
                    <option>壁画</option>
                    <option>漆木器</option>
                    <option>纺织品</option>
                    <option>其他</option>
                </select>
                <h6>类别</h6>
                <select v-model="addData.category">
                    <!--<option v-for="category in category_list" v-show="category.name" :value="category.name">{{category.name}}</option>-->
                    <option>玉石器、宝石</option>
                    <option>陶器</option>
                    <option>瓷器</option>
                    <option>铜器</option>
                    <option>金银器</option>
                    <option>铁器、其他金属器</option>
                    <option>雕塑、造像</option>
                    <option>石器、石刻、砖瓦</option>
                    <option>书法、绘画</option>
                    <option>文具</option>
                    <option>甲骨</option>
                    <option>玺印符牌</option>
                    <option>钱币</option>
                    <option>牙骨角器</option>
                    <option>竹木雕</option>
                    <option>家具</option>
                    <option>珐琅器</option>
                    <option>织绣</option>
                    <option>古籍善本</option>
                    <option>碑帖拓本</option>
                    <option>武器</option>
                    <option>邮品</option>
                    <option>文件、宣传品</option>
                    <option>档案文书</option>
                    <option>名人遗物</option>
                    <option>玻璃器</option>
                    <option>乐器、法器</option>
                    <option>皮革</option>
                    <option>音像制品</option>
                    <option>票据</option>
                    <option>交通、运输工具</option>
                    <option>度量衡器</option>
                    <option>标本、化石</option>
                    <option>漆器</option>
                    <option>其他</option>
                </select>
                <h6>年代</h6>
                <select v-model="addData.age |eliminate_space">
                    <!--<option v-for="age in age_list" v-show="age.name" :value="age.name">{{age.name}}</option>-->
                    <option>夏</option>
                    <option>商</option>
                    <option>周</option>
                    <option>西周</option>
                    <option>东周</option>
                    <option>春秋</option>
                    <option>战国</option>
                    <option>秦</option>
                    <option>汉</option>
                    <option>西汉</option>
                    <option>东汉</option>
                    <option>三国</option>
                    <option>魏</option>
                    <option>蜀</option>
                    <option>孙吴</option>
                    <option>西晋</option>
                    <option>东晋十六国</option>
                    <option>东晋</option>
                    <option>十六国</option>
                    <option>南北朝</option>
                    <option>南朝</option>
                    <option>宋</option>
                    <option>齐</option>
                    <option>梁</option>
                    <option>陈</option>
                    <option>北朝</option>
                    <option>北魏</option>
                    <option>东魏</option>
                    <option>北齐</option>
                    <option>西魏</option>
                    <option>北周</option>
                    <option>隋</option>
                    <option>唐</option>
                    <option>五代十国</option>
                    <option>后梁</option>
                    <option>后唐</option>
                    <option>后晋</option>
                    <option>后汉</option>
                    <option>后周</option>
                    <option>十国</option>
                    <option>宋朝</option>
                    <option>北宋</option>
                    <option>南宋</option>
                    <option>辽</option>
                    <option>西夏</option>
                    <option>金</option>
                    <option>元</option>
                    <option>明</option>
                    <option>清</option>
                    <option>中华民国</option>
                    <option>中华人民共和国</option>
                </select>
                <h6>等级</h6>
                <select v-model="addData.level">
                    <!--<option v-for="level in level_list" v-show="level.name" :value="level.name">{{level.name}}</option>-->
                    <option>一级文物</option>
                    <option>二级文物</option>
                    <option>三级文物</option>
                    <option>一般文物</option>
                    <option>未定级文物</option>
                </select>
                <h6>保存状态</h6>
                <input type="text" v-model="addData.status" disabled>
                <!--<select v-model="addData.status">-->
                    <!--<option>不需修复</option>-->
                    <!--<option>需要修复</option>-->
                    <!--<option>亟需修复</option>-->
                    <!--<option>展陈</option>-->
                    <!--<option>修复</option>-->
                    <!--<option>巡展</option>-->
                    <!--<option>借调</option>-->
                    <!--<option>已归还</option>-->
                    <!--<option>借入</option>-->
                <!--</select>-->
                <div @click.stop="upload_layout()" class="equip_add_image" style="margin-top: 10px">添加藏品图片</div>
                <!--<input type ="file" id="ImportPicInput" @click="upload_layout()"/>-->
                <Tag v-if="uploadImageShow" closable @on-close="handleClose">{{uploadImageName}}</Tag>
            </div>
            <div class="Environmental_requirements data">
                <h5>环境要求</h5>
                    <div class="twoLine"><span class="temperature"><i ></i></span>
                    <div>
                        <p>温度范围 <input type="text" v-model="rangeData.temperature_min"/> ~ <input type="text" v-model="rangeData.temperature_max"/> ℃ </p>
                        <p>温度日波动 ≤ <input type="text" v-model="rangeData.temperature_range"/> °C/d</p>
                    </div>
                </div>
                <div class="twoLine"><span class="humidity"><i></i></span>
                    <div>
                        <p>湿度范围 <input type="text" v-model="rangeData.humidity_min"/> ~ <input type="text" v-model="rangeData.humidity_max"/> % </p>
                        <p>湿度日波动 ≤ <input type="text" v-model="rangeData.humidity_range"/> %/d</p>
                    </div>
                </div>
                <div class="twoLine"><span class="light"><i></i></span>
                    <div>
                        <p>照度  ≤ <input type="text" v-model="rangeData.light_max"/> lx </p>
                        <p>累积照度  ≤ <input type="text" v-model="rangeData.total_light"/> lx</p>
                    </div>
                </div>
                <div class="oneLine"><span class="uv"><i></i></span>
                    <p>紫外照度 ≤ <input type="text" v-model="rangeData.uv_max"/> μW/cm²</p>
                </div>
                <div class="oneLine"><span class="voc"><i></i></span>
                    <p>有机挥发物 ≤ <input type="text" v-model="rangeData.voc_max"/> ppb</p>
                </div>
            </div>
            <div class="Management_information">
                <h5>管理信息</h5>
                <h6 @click="showBox" v-text="infor"></h6>
                <div class="treeSelect hideInput">
                    <tree-list :tree_list="tree_list" :keyword="keyword" :sel_list.sync="sel_env" :session_key="session_key"></tree-list>
                </div>
                <!--<div class="imgView"></div>-->
            </div>
        </section>
        <footer>
            <div class="btnsContainer">
                <div class="over continue" @click="continueOver">继续添加藏品</div>
                <div class="over" @click="postOver">添加藏品</div>
            </div>
        </footer>
    </div>
</template>


	<!--文物出库-->
	<template id="relicsOutStorage">
    <div class="moduleContainer">
        <header>
            <div @click="goBack" class="topTitle">
                <Icon type="chevron-left"></Icon>藏品出库
            </div>
            <div class="filterWrap">
                <filter-component type="relic_manage" hide-type="out"></filter-component>
            </div>
            <div class="topFunction">
                <i-button type="ghost" @click="okHandler">出库</i-button>
            </div>
        </header>
        <section>
            <!--&lt;!&ndash;藏品筛选&ndash;&gt;-->
            <!--<cultural-relics @new-data="resetOption" :relic_filter="relic_filter" :hide_filter="hideFilter"></cultural-relics>-->

            <div class="relicTableContainer">
                <div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
                    <!--<p>这里显示藏品图片</p>-->
                    <img :src="img_src" :alt="img_src"/>
                </div>
                <div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
                    <!--<p>这里显示地理位置信息</p>-->
                    <div class="view">
                        <div class="point" :data-title="nav_name"></div>
                        <img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
                    </div>
                </div>
                <!--显示表格数据-->
                <section class="tableWrap">
                    <table>
                        <thead>
                        <tr>
                            <th width="4%">
                                <!--:indeterminate="true" 部分选中状态-->
                                <input type="checkbox" v-model="allStatus" @click="changeStatus"/>
                            </th>
                            <th>
                                状态
                            </th>
                            <th>
                                藏品名称
                            </th>
                            <th>
                                总登记号
                            </th>
                            <th>
                                材质
                            </th>
                            <th>
                                类型
                            </th>
                            <th>
                                等级
                            </th>
                            <th>
                                年代
                            </th>
                            <th>
                                位置
                            </th>
                            <!--<th>-->
                                <!--最新数据-->
                            <!--</th>-->
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="relic in tableData">
                            <td>
                                <!--:checked="selRelics.indexOf(relic.relic_no)!=-1"-->
                                <input type="checkbox" v-if="relic&&relic.relicNo" @click="changeRelic(relic)" :value="relic.relicNo" v-model="selRelics"/>
                            </td>
                            <td>
                                <!--{no_need_repair:relic.status=='不需修复'||relic.status=='无需修复',need_repair:relic.status=='需要修复',need_repair_asap:relic.status=='亟需修复'||relic.status=='亟待修复',in:relic.status=='展出'||relic.status=='修复中'||relic.status=='修复'||relic.status=='研究中'||relic.status=='研究'||relic.status=='已归还',out:relic.status=='借出'||relic.status=='借入'}-->
                                <span class="relic_status_item" :class="relic.status">{{relic.status||'无状态信息'}}</span>
                            </td>
                            <td class="left relic_name_no" style="position: relative;">
                                <p style="cursor: pointer;padding-left: 30px" @click="jumpDetails(relic.relicNo)">
                                    <img v-if="relic.image" style="vertical-align: middle;margin-right:5px;" :src="relic.image" :alt="" @mouseenter.stop="show_big_img($event,relic.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{relic.name}}</span>
                                </p>
                            </td>
                            <td>
                                {{relic.relicId||''}}
                                <!--{{relic.relicNo||''}}-->
                            </td>
                            <td>
                                {{relic.material}}
                            </td>
                            <td>
                                {{relic.category}}
                            </td>
                            <td>
                                {{relic.level}}
                            </td>
                            <td>
                                {{relic.age}}
                            </td>
                            <td class="left">
                                <!--@click="goEnvDetail(relic.parent_env_no)"位置图不提供跳转功能-->
                                <p style="position: relative;padding-left: 25px;">
                                    <span v-if="relic.map&&relic.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,relic.map,relic.locate,relic)" @mouseleave="hide_big_nav"></span>
                                    {{nav_info(relic.nav)||'暂无位置信息'}}
                                </p>
                            </td>
                            <!--<td>-->
                                <!--&lt;!&ndash;{{relic.new_data}}&ndash;&gt;-->
                                <!--<span v-if="relic.new_data&&relic.new_data.temperature">温度:{{relic.new_data.temperature}}</span>-->
                                <!--<span v-if="relic.new_data&&relic.new_data.humidity">湿度:{{relic.new_data.humidity}}</span>-->
                            <!--</td>-->
                        </tr>
                        </tbody>
                    </table>
                </section>
                <!--显示分页页码-->
                <footer>
                    <page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>
                </footer>
                <div class="loading" v-show="tableLoading"></div>
            </div>
        </section>
        <Modal
                title="藏品出库"
                :visible.sync="modalVisible"
                class-name="vertical-center-modal"
                :mask-closable="false"
                :scrollable="false"
        >
            <div>
                <Row type="flex" align="top">
                    <i-col span="5">
                        <p style="text-align: left;line-height: 32px;">
                            出库状态选择 :
                        </p>
                    </i-col>
                    <i-col span="10">
                        <i-select :model.sync="status">
                            <!--<Option-group label="库藏藏品">-->
                                <!--<i-option value="不需修复">不需修复</i-option>-->
                                <!--<i-option value="需要修复">需要修复</i-option>-->
                                <!--<i-option value="亟需修复">亟需修复</i-option>-->
                            <!--</Option-group>-->
                            <Option-group label="离库藏品">
                                <!--如果选中的藏品中有亟需修复的藏品,则展陈和巡展两种出库状态不可选-->
                                <i-option value="展陈" :disabled="needRepair">展陈</i-option>
                                <i-option value="科研">科研</i-option>
                                <i-option value="修复">修复</i-option>
                                <i-option value="巡展" :disabled="needRepair">巡展</i-option>
                                <i-option value="借出">借出</i-option>
                            </Option-group>
                        </i-select>
                    </i-col>
                    <i-col span="9">
                        <p style="text-align: right;line-height: 32px;padding-right:15px;">
                            选中藏品数量: {{modalTableData.length}} 件
                        </p>
                    </i-col>
                </Row>
                <div class="modalTabelContainer">
                    <table>
                        <thead>
                        <tr>
                            <th>藏品名称</th>
                            <th>总登记号</th>
                            <th>材质</th>
                            <th>等级</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="relic in modalTableData" track-by="$index">
                            <td>{{relic.name}}</td>
                            <td>{{relic.relicId}}</td>
                            <!--<td>{{relic.relicNo}}</td>-->
                            <td>{{relic.material}}</td>
                            <td>{{relic.level}}</td>
                            <td>
                                <Icon type="android-close" size="18" color="red" style="cursor:pointer;" @click="removeRelic(relic)"></Icon>
                            </td>
                        </tr>
                        <tr v-show="!modalTableData||modalTableData.length===0">
                            <td colspan="5">
                                未选中出库藏品
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div slot="footer">
                <i-button type="primary" @click="out_storage_ok">确认出库</i-button>
                <i-button type="ghost" @click="out_storage_cancel">取消</i-button>
            </div>
        </Modal>
    </div>
</template>

	<!--文物盘点-->
	<template id="relicsCheck">
    <div class="moduleContainer">
        <header>
            <div @click="goBack" class="topTitle">
                <Icon type="chevron-left"></Icon>藏品盘点
            </div>
            <div class="topFunction">
                <i-button type="ghost" @click="newPlanHandler">发起盘点</i-button>
            </div>
        </header>
        <section>
            <div class="relicTableContainer">
                <!--显示表格数据-->
                <section class="tableWrap">
                    <table>
                        <thead>
                        <tr>
                            <th>
                                状态
                            </th>
                            <th>
                                计划名称
                            </th>
                            <th>
                                计划ID
                            </th>
                            <th>
                                盘点件数
                            </th>
                            <th>
                                发起人
                            </th>
                            <th>
                                执行人
                            </th>
                            <th>
                                完成时间
                            </th>
                            <th>
                                备注
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-show="!tableData||tableData.length===0">
                            <td colspan="8">
                                暂无盘点任务
                            </td>
                        </tr>
                        <tr v-for="plan in tableData">
                            <td :class="plan.result">
                                {{plan.result||'-'}}
                            </td>
                            <td>
                                <a href="javascript:void(0)" @click="goPlanDetail(plan.id)">{{plan.name||'未命名计划'}}</a>
                            </td>
                            <td>
                                {{plan.taskId||'-'}}
                            </td>
                            <td>
                                {{plan.totalNum||0}}
                            </td>
                            <td>
                                {{plan.initiatorUsername}}
                            </td>
                            <td>
                                {{plan.operatorUsername}}
                            </td>
                            <td>
                                {{formatTime(plan.endTime)}}
                            </td>
                            <td>
                                {{plan.desc}}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
                <!--显示分页页码-->
                <footer>
                    <page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>
                </footer>
                <div class="loading" v-show="tableLoading"></div>
            </div>
        </section>
    </div>
</template>


	<!--发起盘点-->
	<template id="newPlan">
    <div class="moduleContainer newPlan">
        <header>
            <div @click="goBack" class="topTitle">
                <Icon type="chevron-left"></Icon>发起盘点
            </div>
            <div class="filterWrap">
                <filter-component type="relic_manage"></filter-component>
            </div>
            <div class="topFunction">
                <i-button type="ghost" @click="okHandler">确认发起</i-button>
            </div>
        </header>
        <div class="tableWrap">
            <table>
                <thead>
                <tr>
                    <th>
                        计划名称
                    </th>
                    <!--<th>-->
                        <!--计划ID-->
                    <!--</th>-->
                    <th>
                        盘点件数
                    </th>
                    <th>
                        发起人
                    </th>
                    <th>
                        执行人
                    </th>
                    <th>
                        要求完成时间
                    </th>
                    <th>
                        备注
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <i-input placeholder="输入计划名称" :value.sync="planInfo.name"></i-input>
                    </td>
                    <!--<td>-->
                        <!--计划ID-->
                    <!--</td>-->
                    <td>
                        {{selRelics.length}}
                    </td>
                    <td>
                        {{planInfo.initiatorUsername}}
                        <!--<i-select :model.sync="planInfo.initiatorUsername" placeholder="选择发起人" style="width:200px;">-->
                            <!--<i-option value="超级管理员" v-if="isAdmin">超级管理员</i-option>-->
                            <!--<i-option v-for="user in userList" v-if="user.realName" :value="user.realName">{{user.realName}}</i-option>-->
                        <!--</i-select>-->
                    </td>
                    <td>
                        <i-select :model.sync="planInfo.operatorUsername" placeholder="选择执行人" style="width:200px;">
                            <i-option value="超级管理员" v-if="isAdmin">超级管理员</i-option>
                            <i-option v-for="user in userList" :value="user.realName||user.username">{{user.realName||user.username}}</i-option>
                        </i-select>
                    </td>
                    <td>
                        <Date-picker
                                type="datetime"
                                placeholder="要求完成时间"
                                style="width: 200px;margin:0 auto;"
                                :value.sync="time"
                                :options="dateOpt"
                                @on-change="changeTime"
                                :editable="false"
                                :clearable="false"
                                @on-clear="clearTime"
                                @on-ok="okTime"
                        >
                        </Date-picker>
                    </td>
                    <td>
                        <i-input placeholder="备注" :value.sync="planInfo.remark"></i-input>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <section>
            <!--<cultural-relics @new-data="resetOption" :relic_filter="relic_filter" :hide_filter="hideFilter"></cultural-relics>-->
            <div class="relicTableContainer">
                <div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
                    <!--<p>这里显示文物图片</p>-->
                    <img :src="img_src" :alt="img_src"/>
                </div>
                <div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
                    <!--<p>这里显示地理位置信息</p>-->
                    <div class="view">
                        <div class="point" :data-title="nav_name"></div>
                        <img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
                    </div>
                </div>
                <!--显示表格数据-->
                <section class="tableWrap" style="top:10px;">
                    <table>
                        <thead>
                        <tr>
                            <th width="4%">
                                <!--:indeterminate="true" 部分选中状态-->
                                <input type="checkbox" v-model="allStatus" @click="changeStatus"/>
                            </th>
                            <th>
                                状态
                            </th>
                            <th>
                                藏品名称
                            </th>
                            <th>
                                总登记号
                            </th>
                            <th>
                                材质
                            </th>
                            <th>
                                类型
                            </th>
                            <th>
                                等级
                            </th>
                            <th>
                                年代
                            </th>
                            <th>
                                位置
                            </th>
                            <th>
                                最新数据
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <!--<tr v-for="n in limit">-->
                            <!--<td width="4%">-->
                                <!--&lt;!&ndash;:indeterminate="true" 部分选中状态&ndash;&gt;-->
                                <!--<input type="checkbox"/>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--状态-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--藏品名称{{n}}-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--总登记号-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--材质-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--类型-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--等级-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--年代-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--位置-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--最新数据-->
                            <!--</td>-->
                        <!--</tr>-->
                        <tr v-for="relic in tableData">
                            <td>
                                <!--:checked="selRelics.indexOf(relic.relic_no)!=-1"-->
                                <input type="checkbox" v-if="relic&&relic.relicNo" :value="relic.relicNo" v-model="selRelics" @click="changeRelic(relic.relicNo)" />
                            </td>
                            <td>
                                <!--{no_need_repair:relic.status=='不需修复'||relic.status=='无需修复',need_repair:relic.status=='需要修复',need_repair_asap:relic.status=='亟需修复'||relic.status=='亟待修复',in:relic.status=='展出'||relic.status=='修复中'||relic.status=='修复'||relic.status=='研究中'||relic.status=='研究'||relic.status=='已归还',out:relic.status=='借出'||relic.status=='借入'}-->
                                <span class="relic_status_item" :class="relic.status">{{relic.status||'无状态信息'}}</span>
                            </td>
                            <td class="left relic_name_no" style="position: relative;">
                                <p style="cursor: pointer;padding-left: 30px" @click="jumpDetails(relic.relic_no)">
                                    <img v-if="relic.image" style="vertical-align: middle;margin-right:5px;" :src="relic.image" :alt="" @mouseenter.stop="show_big_img($event,relic.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{relic.name}}</span>
                                </p>
                            </td>
                            <td>
                                {{relic.relicId||''}}
                                <!--{{relic.relicNo||''}}-->
                            </td>
                            <td>
                                {{relic.material}}
                            </td>
                            <td>
                                {{relic.category}}
                            </td>
                            <td>
                                {{relic.level}}
                            </td>
                            <td>
                                {{relic.age}}
                            </td>
                            <td class="left">
                                <!--@click="goEnvDetail(relic.parent_env_no)"位置图不提供跳转功能-->
                                <p style="position: relative;padding-left: 25px;">
                                    <span v-if="relic.map&&relic.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,relic.map,relic.locate,relic)" @mouseleave="hide_big_nav"></span>
                                    {{nav_info(relic.nav)||'暂无位置信息'}}
                                </p>
                            </td>
                            <td>
                                <!--{{relic.new_data}}-->
                                <span v-if="relic.new_data&&relic.new_data.temperature">温度:{{relic.new_data.temperature}}</span>
                                <span v-if="relic.new_data&&relic.new_data.humidity">湿度:{{relic.new_data.humidity}}</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
                <!--显示分页页码-->
                <footer>
                    <page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>
                </footer>
                <div class="loading" v-show="tableLoading"></div>
            </div>
        </section>
    </div>
</template>

	<!--盘点详情-->
	<template id="planDetail">
    <div class="moduleContainer planDetail">
        <header>
            <div @click="goBack" class="topTitle">
                <Icon type="chevron-left"></Icon>盘点详情
            </div>
            <!--盘点详情涉及垮库查询,暂时使用之前的筛选-->
            <div class="filterWrap">
                <filter-component type="relic_manage" hide-type="plan_detail" :task-id="planId"></filter-component>
            </div>
            <div class="topFunction">
                <i-button type="error" @click="deletePlanHandler">删除计划</i-button>
            </div>
        </header>
        <div class="tableWrap">
            <table>
                <thead>
                <tr>
                    <th>
                        状态
                    </th>
                    <th>
                        计划名称
                    </th>
                    <th>
                        计划ID
                    </th>
                    <th>
                        盘点件数
                    </th>
                    <th>
                        发起人
                    </th>
                    <th>
                        执行人
                    </th>
                    <th>
                        要求完成时间
                    </th>
                    <th>
                        备注
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr v-show="!topInfo">
                    <td colspan="8">
                        信息读取中...
                    </td>
                </tr>
                <tr v-if="topInfo">
                    <td :class="topInfo.result">
                        {{topInfo.result}}
                    </td>
                    <td>
                        {{topInfo.name||'未命名计划'}}
                    </td>
                    <td>
                        {{topInfo.taskId||'-'}}
                    </td>
                    <td>
                        {{topInfo.totalNum||0}}
                    </td>
                    <td>
                        {{topInfo.initiatorUsername}}
                    </td>
                    <td>
                        {{topInfo.operatorUsername}}
                    </td>
                    <td>
                        {{formatTime(topInfo.endTime)}}
                    </td>
                    <td>
                        {{topInfo.desc}}
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <section>
            <!--<cultural-relics @new-data="resetOption" :relic_filter="relic_filter" :hide_filter="hideFilter"></cultural-relics>-->
            <div class="relicTableContainer" style="top:0;">
                <div class="relic_pic" v-show="big_img_status" @mouseleave="hide_big_img">
                    <!--<p>这里显示文物图片</p>-->
                    <img :src="img_src" :alt="img_src"/>
                </div>
                <div class="nav_pic" v-show="big_nav_status" @mouseleave="hide_big_nav" @mouseenter="in_big_nav">
                    <!--<p>这里显示地理位置信息</p>-->
                    <div class="view">
                        <div class="point" :data-title="nav_name"></div>
                        <img :src="nav_map" alt="图片无法显示" :width="nav_width" :height="nav_height" id="nav_map"/>
                    </div>
                </div>
                <!--显示表格数据-->
                <section class="tableWrap">
                    <table>
                        <thead>
                        <tr>
                            <th>
                                状态
                            </th>
                            <th>
                                RFID标签号
                            </th>
                            <th>
                                藏品名称
                            </th>
                            <th>
                                总登记号
                            </th>
                            <th>
                                材质
                            </th>
                            <th>
                                等级
                            </th>
                            <th>
                                位置
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-show="!tableData||tableData.length===0">
                            <td colspan="7">
                                暂无盘点数据
                            </td>
                        </tr>
                        <tr v-for="relic in tableData">
                            <td>
                                <!--:checked="selRelics.indexOf(relic.relic_no)!=-1"-->
                                <!--<input type="checkbox" v-if="relic&&relic.relic_no" @click="changeRelic(relic.relic_no)" :value="relic.relic_no" v-model="selRelics"/>-->
                                <Icon v-show="relic.result&&relic.result==='相符'" type="checkmark-round" size="16" color="#00cc66"></Icon>
                                <Icon v-show="relic.result&&relic.result==='盘盈'" type="plus-round" size="16" color="#ff6600"></Icon>
                                <!--{{relic.result}}-->
                            </td>
                            <td>

                                {{relic.tagNo||'未关联'}}
                            </td>
                            <!--<td>-->
                                <!--&lt;!&ndash;{no_need_repair:relic.status=='不需修复'||relic.status=='无需修复',need_repair:relic.status=='需要修复',need_repair_asap:relic.status=='亟需修复'||relic.status=='亟待修复',in:relic.status=='展出'||relic.status=='修复中'||relic.status=='修复'||relic.status=='研究中'||relic.status=='研究'||relic.status=='已归还',out:relic.status=='借出'||relic.status=='借入'}&ndash;&gt;-->
                                <!--<span class="relic_status_item" :class="relic.status">{{relic.status||'无状态信息'}}</span>-->
                            <!--</td>-->
                            <td class="left relic_name_no" style="position: relative;">
                                <p style="cursor: pointer;padding-left: 30px" @click="jumpDetails(relic.relicNo)">
                                    <img v-if="relic.image" style="vertical-align: middle;margin-right:5px;" :src="relic.image" :alt="" @mouseenter.stop="show_big_img($event,relic.image)" @mouseleave="hide_big_img"/><span class="relic_name">{{relic.name}}</span>
                                    <!--<span class="relic_no">{{relic.relic_no}}</span>-->
                                </p>
                            </td>
                            <td>
                                {{relic.relicId||''}}
                                <!--{{relic.relicNo||''}}-->
                            </td>
                            <td>
                                {{relic.material}}
                            </td>
                            <!--<td>-->
                                <!--{{relic.category}}-->
                            <!--</td>-->
                            <td>
                                {{relic.level}}
                            </td>
                            <!--<td>-->
                                <!--{{relic.age}}-->
                            <!--</td>-->
                            <td class="left">
                                <!--@click="goEnvDetail(relic.parent_env_no)"位置图不提供跳转功能-->
                                <p style="position: relative;padding-left: 25px;">
                                    <span v-if="relic.map&&relic.locate" class="nav_icon" @mouseenter.stop="show_big_nav($event,relic.map,relic.locate,relic)" @mouseleave="hide_big_nav"></span>
                                    {{nav_info(relic.nav)||'暂无位置信息'}}
                                </p>
                            </td>
                            <!--<td>-->
                                <!--&lt;!&ndash;{{relic.new_data}}&ndash;&gt;-->
                                <!--<span v-if="relic.new_data.temperature">温度:{{relic.new_data.temperature}}</span>-->
                                <!--<span v-if="relic.new_data.humidity">湿度:{{relic.new_data.humidity}}</span>-->
                            <!--</td>-->
                        </tr>
                        </tbody>
                    </table>
                </section>
                <!--显示分页页码-->
                <footer>
                    <page-list @turn-page="turnPage" :page.sync="page" :allPage="allPage" :count.sync="count"></page-list>
                </footer>
                <div class="loading" v-show="tableLoading"></div>
            </div>
        </section>
    </div>
</template>


<script type="text/javascript">
    require('capsule');
</script>
</body>
</html>